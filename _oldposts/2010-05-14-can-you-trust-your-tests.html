---
layout: post
title: "Can you trust your tests?"
date: 2010-05-14
comments: true
tags: [  Unit Testing, Software testing ]
---

One important thing about unit testing but also about testing in general is that you can <b>trust</b>&nbsp;your tests. If that nice little bar shines green, then your logic should be fine. If you cannot trust in your tests then they're pretty useless. But what does <b>trust</b>&nbsp;mean? When can I trust my tests?<br /><br />The following things come to my mind when trying to answer this question:<br /><br /><span class="Apple-style-span"><span class="Apple-style-span" style="font-size: x-large;">Do test-first development</span></span><br />Now thats one of the most difficult parts, unit testing "beginners" will have to face. You will always again catch yourself, first writing the implementation part. That happens to me too, but in such a case, I immediately stop writing that logic, comment it out and see the test fail.<br />Seeing that test fail is so important to be able to trust it, because if you see your test succeed, although you commented out that code part you'd like to test, then you're in trouble. Basically the test isn't good for anything.<br /><div><br /></div><div><span class="Apple-style-span"><span class="Apple-style-span" style="font-size: x-large;">Analyze!</span></span><br />Analyzing is important to strengthen your trust. Having tests in place, covering 20% of your code doesn't really mean you didn't break anything if you see all of your tests succeed. Sounds reasonable, doesn't it?<br />It is therefore important to also have some statistics about your test-code-coverage in place. Now since I'm right now writing on my thesis project I'm bringing an example of Java and Eclipse, but <a href="http://blog.gfader.com/">Peter</a> assured me, VS2010 has a similar thing already integrated (I have to check it out these days).<br />In Eclipse you have a nice plugin called <a href="http://www.eclemma.org/">EclEmma</a> which does this job for you. Let's look at an example.<br /><br />I have a repository object, basically an extremely simplified version of Fowler's <a href="http://martinfowler.com/eaaCatalog/repository.html">repository pattern</a>&nbsp;(maybe I shouldn't even mention it, it's too simplistic, but anyway, the idea is the same).&nbsp;The repository is basically the connector between my logic and DB persistence related stuff. It keeps an in-memory cache and otherwise queries the DB accordingly.&nbsp;I wrote according tests to make sure everything works as expected. Running the tests with EclEmma results in a success of my test and furthermore my code gets highlighted depending on whether that logic is covered by some test case or not:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/_tF6XjsUy87k/S-12JHf-RVI/AAAAAAAACkQ/a-ioV4bR14k/s1600/eclemma_first_run.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="427" src="http://2.bp.blogspot.com/_tF6XjsUy87k/S-12JHf-RVI/AAAAAAAACkQ/a-ioV4bR14k/s640/eclemma_first_run.png" width="640" /></a></div><br />Oops, &nbsp;note the red part, it means no test covers this logic. Apparently I forgot to test my repository with an attached DAO object. By creating a mock implementation of the according IBluetoothDeviceDao class, an according test case and by running the tests using EclEmma again, I get the following:<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/_tF6XjsUy87k/S-129gb_BNI/AAAAAAAACkU/uv3oLqU8I7I/s1600/eclemma_fixed_run.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="464" src="http://3.bp.blogspot.com/_tF6XjsUy87k/S-129gb_BNI/AAAAAAAACkU/uv3oLqU8I7I/s640/eclemma_fixed_run.png" width="640" /></a></div><br />You immediately see the difference. I increased my code coverage. The remaining red part is because I didn't yet explicitly test the exception handling logic.<br />This visualization is extremely nice because you can verify the coverage immediately after each test-run.<br /><br /><u>References</u><br /><a href="http://www.eclemma.org/">http://www.eclemma.org/</a></div>