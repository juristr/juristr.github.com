---
layout: post
title: "News Mapper: A mashup experience with the Google Mashup Editor"
date: 2007-10-29
comments: false
tags: [  JavaScript, Projects, Google ]
---

Now in the two weeks after my successful <a href="http://juri-strumpflohner.blogspot.com/2007/10/finally-graduated.html">graduation</a> and before starting to work I found some space for doing some programming experiments. :) What I planned already for a<a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://1.bp.blogspot.com/_tF6XjsUy87k/RyW6obfEaMI/AAAAAAAAAwE/KpspIAS6oJQ/s1600-h/logo.png"><img style="margin: 0pt 0pt 10px 10px; float: right; cursor: pointer;" src="http://1.bp.blogspot.com/_tF6XjsUy87k/RyW6obfEaMI/AAAAAAAAAwE/KpspIAS6oJQ/s400/logo.png" alt="" id="BLOGGER_PHOTO_ID_5126708954566781122" border="0" /></a> longer time now has been to do some JavaScript coding since it becomes an always more important aspect in modern web technologies such as AJAX and so on. My experience till now was quite limited by just coding in a try-and-see fashion since I've never really learned JavaScript.<br />Since the best way is to learn-by-doing, I started to develop a project which I had already in mind for quite a long time now: "mashing up" news and maps. The basic idea is to display news on a Google Map depending on their location. I already did such a project during the Internet Technologies II course at the University with some study colleagues. At that time we created an ASP.NET application (with an IIS webserver) for displaying the map and the news on it and a local C#.NET deamon which was intended to run at the server for collecting, geocoding and storing all of the news in the web application's database. The project outcome was quite cool. This time however I wanted to realize the application without a server-side part by just using client-side JavaScript. That was the main challenge.<br /><br /><span style="font-weight: bold;font-size:130%;" >Google Mashup Editor</span><br />About half a year ago now, Google launched a new product called the <a href="http://editor.googlemashups.com/">Google Mashup Editor</a>. The aim was to provide an environment for easily developing, hosting and publishing Google Mashups as there are quite a lot available around the web. Till now I was quite busy with my thesis project wherefore I never had the opportunity to play with their new product which is currently just available to about a thousand developers. Being one of those I now wanted to<a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://1.bp.blogspot.com/_tF6XjsUy87k/RyM_e7fEaHI/AAAAAAAAAvc/H5wUu0BeTBM/s1600-h/GoogleCodeSiteLarge.png"><img style="margin: 0pt 0pt 10px 10px; float: right; cursor: pointer;" src="http://4.bp.blogspot.com/_tF6XjsUy87k/RyM-DrfEaGI/AAAAAAAAAvU/uNpJbtpDL_4/s400/GoogleCodeSite.png" alt="" id="BLOGGER_PHOTO_ID_5126009033811322978" border="0" /></a> make use of it and build my <a href="http://en.wikipedia.org/wiki/Mashup_%28web_application_hybrid%29">mashup</a> project on top of the GME API. Moreover this promised me a lot more users since the project will be promoted on the official Google Code pages (see image on the right).<br /><br /><span style="font-weight: bold;font-size:130%;" >News Mapper - Intro</span><br />The development of the application itself was quite straightforward once I understood the basics of the Google Mashup Editor. The majority of the information is well documented on the <a href="http://code.google.com/gme/gettingstarted.html">Google Mashup main website</a>. The page documents the <a href="http://code.google.com/gme/gettingstarted.html#structure_of_a_mashup_application">basic structure</a> of a mashup application and gives a lot of samples for getting started. Anyway during the development undocumented problems may occur. In this case I suggest you to contact the developers over the <a href="http://groups.google.com/group/google-mashup-editor">forum</a>. I had to do that several times and I was also able to contribute a little to the editor by <a href="http://groups.google.com/group/google-mashup-editor/browse_thread/thread/44901d44717de46f">submitting a bug</a>. Taking this occasion I would like to say that the Mashup development team is for sure one of the most responsive Google teams. I submitted several questions and got an answer even within the same day. This holds especially for Jason Cooper (Google Mashup team member) which does a great job by supporting early mashup developers (including myself) by supplying useful tips and sample projects and often also still undocumented and hidden features. His hints helped a lot in the development of my News Mapper. This responsiveness is in my eyes also one of the main reasons why many of the Google products have such a great success. Building a stable user community is essential for such services since you get a lot of usage statistics, bug reports and suggestions which help to improve the product. Moreover it is nice - being myself a  software developer - to see that one is able to contribute to such products by providing bug reports or feature suggestions.<br /><br /><span style="font-weight: bold;font-size:130%;" >News Mapper - How does it work?</span><br />I'd like to explain the News Mapper system with the following figure. As you probably imagine ;) I like those "free-form" diagrams. They illustrate the system in an informal way and help to understand how things are correlated.<br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://2.bp.blogspot.com/_tF6XjsUy87k/RyW72rfEaNI/AAAAAAAAAwM/GbctZpdK4Lg/s1600-h/NewsMapperSystem.png"><img style="margin: 0px auto 10px; display: block; text-align: center; cursor: pointer;" src="http://2.bp.blogspot.com/_tF6XjsUy87k/RyW72rfEaNI/AAAAAAAAAwM/GbctZpdK4Lg/s400/NewsMapperSystem.png" alt="" id="BLOGGER_PHOTO_ID_5126710298891544786" border="0" /></a>I will explain here just briefly the main and most interesting things of the News Mapper application. Other things such as generalities about the GME can be read in its <a href="http://code.google.com/gme/index.html">documentation</a>.<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://2.bp.blogspot.com/_tF6XjsUy87k/RyNBtLfEaII/AAAAAAAAAvk/PyD-xOOc_mw/s1600-h/1.png"><img style="margin: 0pt 10px 10px 0pt; float: left; cursor: pointer;" src="http://2.bp.blogspot.com/_tF6XjsUy87k/RyNBtLfEaII/AAAAAAAAAvk/PyD-xOOc_mw/s400/1.png" alt="" id="BLOGGER_PHOTO_ID_5126013045310777474" border="0" /></a>The first and probably most important aspect is how the system interacts with the outside world, meaning how it retrieves the data. GME applications can use two different data sources: external feeds (RSS or Atom) and application-internal built-in data sources such as ${app}, ${test} and ${user} which are also represented as XML feeds. More about that can be read on <a href="http://code.google.com/gme/data.html">this page</a>. At the moment the News Mapper makes just use of the external data sources in the form of RSS feeds. These are taken from the Reuters web-page. A typical entry's body of the Reuters RSS feed looks as follows:<span style="text-decoration: underline;"><span style="font-weight: bold;"><br /></span></span><blockquote>BAGHDAD (Reuters) - A battle between al Qaeda in Iraq and a major Sunni Arab insurgent group killed at least 16 militants on Friday near the ancient city of Samarra, a senior security officer told Reuters on Saturday.</blockquote>As you can see at the beginning of each feed there is the location given as the name of the city ("BAGHDAD" in this case). My idea was therefore to cut the city string out of the whole text by using the JavaScript <span class="code">split(...)</span> function and to replace then the string-pattern "(Reuters)" with the empty string. This clean string containing the name of the city ("Baghdad") could be sent to the GMap2 geocoding service for getting the lat/lng data. Although this worked quite fine it was a little inconvenient since in the placing of the markers and displaying of info-windows had to be done programmatically and I couldn't make use of the Google Mashup API's map capabilities which requires the lat/lng data to be encoded directly in the RSS feed as XML elements or attributes. This problem however was quickly solved when I found the <a href="http://www.geonames.org/">geonames.org</a>'s webservice RSS to GeoRSS. In this way I could get rid of the geocoding stuff which was taken by that service and moreover it seems that geonames.org does some more sophisticated geocoding by analyzing the entry's content (in this case the article preview). For storing the received, geocoded data the <span class="code">gm:list</span> has been used. This is then linked to the map module as follows:<br /><pre class="code">&lt;gm:map id="map" control="large" height="550px" data="${sourceFeed}"<br />latref="geo:lat" lngref="geo:long" maptypes="true" infotemplate="mapInfoWindowTemplate"&gt;<br />&lt;gm:handleevent src="sourceFeed" event="select"&gt;<br />&lt;/gm:handleevent&gt;&lt;/gm:map&gt;</pre>The "data" attribute contains the id of the data-feed represented as gm:list in the case of the News Mapper. The attributes "latref" and "lngref"contain the GPath expression for retrieving the XML elements containing the location data.<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://1.bp.blogspot.com/_tF6XjsUy87k/RyRQHrfEaJI/AAAAAAAAAvs/6VW3ICVzHfc/s1600-h/2.png"><img style="margin: 0pt 10px 10px 0pt; float: left; cursor: pointer;" src="http://1.bp.blogspot.com/_tF6XjsUy87k/RyRQHrfEaJI/AAAAAAAAAvs/6VW3ICVzHfc/s400/2.png" alt="" id="BLOGGER_PHOTO_ID_5126310368716810386" border="0" /></a>The second thing I'd like to explain is the JavaScript part of the application, especially the one which is responsible for processing the retrieved RSS entries. This was necessary since the Reuters feed contained some HTML code for displaying advertisement and links. This caused some mess when displaying the information in the map-bubbles. For truncating the HTML code out of the RSS entries I used the JavaScript regular expression engine for identifying and replacing the part. The main challenge was to find the right point when to start the processing since it has to be done after the feed has been loaded completely. Here Jason Cooper (GME developer) helped by indicating me that there exists the "repaint" event (details are at the moment still undocumented) which is thrown after the list has finished its loading. In this way, as soon as the gm:list has finished its loading, the JavaScript updates its entries by truncating all HTML code.<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://4.bp.blogspot.com/_tF6XjsUy87k/RyW2qLfEaKI/AAAAAAAAAv0/K7jXXmw6IPI/s1600-h/3.png"><img style="margin: 0pt 10px 10px 0pt; float: left; cursor: pointer;" src="http://4.bp.blogspot.com/_tF6XjsUy87k/RyW2qLfEaKI/AAAAAAAAAv0/K7jXXmw6IPI/s400/3.png" alt="" id="BLOGGER_PHOTO_ID_5126704586585041058" border="0" /></a>The last point which could be interesting is the dynamic changing of the source feed. This is realized with a proper JavaScript function.<br />For the News Mapper I wrote the following lines of code:<br /><pre class="code">/*<br />*  to load different feeds<br />*/<br />function changeSourceFeed(feedURL, feedTitle){<br />feedCleaned = false;<br /><br />//constructing URL of new feed<br />var newFeed = "http://ws.geonames.org/rssToGeoRSS?feedUrl=" + feedURL;<br />debug("URL of newly loaded feed: " + newFeed);<br /><br />//setting title of feed<br />var titleContainer = document.getElementById("feedTitle");<br />titleContainer.innerHTML = feedTitle;<br /><br />//retrieving a reference to the gm:list<br />var listModule = google.mashups.getObjectById("sourceFeed");<br />listModule.setData(newFeed);<br />}</pre>I think the code is self-explanatory since I also added the appropriate comments. This<a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://2.bp.blogspot.com/_tF6XjsUy87k/RyW40rfEaLI/AAAAAAAAAv8/jS90f0yvsoM/s1600-h/feedlist.png"><img style="margin: 0pt 0pt 10px 10px; float: right; cursor: pointer;" src="http://2.bp.blogspot.com/_tF6XjsUy87k/RyW40rfEaLI/AAAAAAAAAv8/jS90f0yvsoM/s400/feedlist.png" alt="" id="BLOGGER_PHOTO_ID_5126706965996923058" border="0" /></a> JavaScript method is then called when the user clicks on the links (see figure on the right). This is done as follows:<br /><pre class="code">&lt;a href="javascript:changeSourceFeed('http://feeds.reuters.com/reuters/topNews', 'Top News');"&gt;Top News&lt;/a&gt;</pre><span style="font-weight: bold;font-size:130%;" >News Mapper - Debugging</span><br />Debugging is one of the points that makes JavaScript programming sometimes a difficult task. A first important point is that you have the possibility to printout some intermediate results (as the Java System.out.println() statements). For doing so, one of the best ways is to define a container in the HTML code as follows:<br /><pre class="code">&lt;div id="debugger"&gt;&lt;/div&gt;</pre>Then a JavaScript function has to be defined that writes to this container for displaying information to the programmer:<br /><pre class="code"><br />   /*<br />   *  For printing debugging information<br />   */<br />   function debug(message){<br />     if(printDebugInfo){<br />       var debugContainer = document.getElementById("debugger");<br />       debugContainer.innerHTML = debugContainer.innerHTML + "<br />" + message;<br />     }<br />   }<br /></pre>This function can then be called from any place in the JavaScript code passing to it the message that has to be displayed. Another interesting tool that is a must for any web/JavaScript programmer is <a href="https://addons.mozilla.org/en-US/firefox/addon/1843">FireBug</a> (Firefox extension). You should take a look at it.<br /><br /><span style="font-size:130%;"><span style="font-weight: bold;">News Mapper - The final outcome</span></span><br />The final outcome can be seen at<br /><div style="text-align: center;"><span style="font-size:130%;"><a href="http://newsmapper.googlemashups.com/">http://newsmapper.googlemashups.com</a></span><br /></div>