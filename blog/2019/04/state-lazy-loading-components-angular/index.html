<!DOCTYPE html>
<html lang="en-us"><head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="generator" content="Hugo 0.53" />
	
	<link rel="shortcut icon" href="/assets/images/sitelogo.jpeg">
	
	<title>Lazy load Angular Components | juri.dev</title>
	
	<meta name="description" content="Or better..how to lazy load Angular Modules. Learn about the state of lazy loading and lazy loading on steroids with Angular Elements">
	
	
	<meta name="robots" content="index, follow">

	
	<meta name="author" content="Juri Strumpflohner">
	<link rel="me" href="https://profiles.google.com/104904743888756261987" />
	<link rel="publisher" href='https://plus.google.com/104904743888756261987' />
	<meta property="twitter:account_id" content="14407063" />


	
	<meta name="google-site-verification" content="0_vyoIaeMG1kXR0h-48gy3OaGl8xoiSJsFDxxCTIBMs" />
	<meta name="google-site-verification" content="AvmssSjl_nchNXIqBW8Agb_UjGqvvLP7HXSxBZ9d0cg" />

	
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:site" content="@juristr" />
	<meta name="twitter:creator" content="@juristr" />
	<meta name="twitter:title" content="Lazy load Angular Components" />
	
	<meta name="twitter:description" content="Or better..how to lazy load Angular Modules. Learn about the state of lazy loading and lazy loading on steroids with Angular Elements" />
	

	
	<meta name="twitter:image:src" content="https://juristr.com/blog/assets/imgs/lazy-load-components.jpg" />
	

	
	<meta property="og:type" content="article" />
	<meta property="og:title" content="Lazy load Angular Components" />
	
	<meta property="og:description" content="Or better..how to lazy load Angular Modules. Learn about the state of lazy loading and lazy loading on steroids with Angular Elements" />
	
	
	<meta property="og:image" content="https://juristr.com/blog/assets/imgs/lazy-load-components.jpg" />
	
	<meta property="og:url" content="https://juristr.com/blog/2019/04/state-lazy-loading-components-angular" />
	<meta property="og:site_name" content="juristr.com" />

	

	
	<link rel="alternate" type="application/rss+xml" title="Juri Strumpflohner" href="//feeds.feedburner.com/juristrumpflohner">
	

	
	<link href="/css/bootstrap.min.css" rel="stylesheet">

	
	
	<link href='//fonts.googleapis.com/css?family=Righteous|Roboto:400,700,900|Source+Code+Pro|Lora:400,700,400italic|Material+Icons'
	 rel='stylesheet' type='text/css'>
	

	

	
	
	
	<link rel="stylesheet" href="/scss/main.min.css" integrity="" media="screen">

	

	

	
	
	<link rel="stylesheet" href="/scss/article.min.css" integrity="" media="screen">
	

	
	
	<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>
<body>
<header class="navbar-light bg-white fixed-top mediumnavigation nav-down">
    <div class="container">

        
        <div class="row justify-content-center align-items-center brandrow">

            <div class="col-lg-4 col-md-4 col-xs-12 d-none d-md-block hidden-xs customarea">
                <img src="/assets/images/gde.svg" style="height:23px">
                <a href="https://developers.google.com/community/experts/directory/profile/profile-juri_strumpflohner" style="
                    padding-left: 5px;
                    font-size: 15pt;
                ">GDE
                    for Web Tech</a>
                

            </div>

            <div class="col-lg-4 col-md-4  col-xs-12 text-center logoarea">
                <a class="navbar-brand" href="https://juristr.com/">
                    
                    <span style="font-family:Righteous;">juri.dev</span>
                    
                </a>
                
            </div>

            <div class="col-lg-4 col-md-4  col-xs-12 text-right d-none d-md-block">
                <a href="https://twitter.com/juristr" class="twitter-follow-button" data-show-count="true">Follow me!</a>
                <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
            </div>

        </div>
        

        <div class="navarea">

            <nav class="navbar navbar-toggleable-sm">
                
                <div id="bs4navbar" class="navbar-collapse">
                    
                    <ul id="menu-top-menu" class="navbar-nav col-md-12 justify-content-center">
                        
                        <li class="menu-item ">
                            <a class="nav-link" href="/">Home</a>
                        </li>
                        
                        <li class="menu-item ">
                            <a class="nav-link" href="/blog">Blog</a>
                        </li>
                        
                        <li class="menu-item ">
                            <a class="nav-link" href="/categories">Collections</a>
                        </li>
                        
                        <li class="menu-item ">
                            <a class="nav-link" href="/newsletter">Newsletter</a>
                        </li>
                        
                        <li class="menu-item ">
                            <a class="nav-link" href="https://github.com/juristr/ama">AMA</a>
                        </li>
                        
                        <li class="menu-item ">
                            <a class="nav-link" href="/about">About Me</a>
                        </li>
                        
                    </ul>

                    
                </div>
            </nav>

        </div>

    </div>

</header>

    <div class="site-content">



<div class="container page-container">
    <div class="row">
        
        <div class="col-md-2 pl-0"><div class="share">
    <p>
        Share
    </p>
    <ul>
        <li>
            <a target="_blank" href="https://twitter.com/home?status=Check out this post by @juristr https%3a%2f%2fjuristr.com%2fblog%2f2019%2f04%2fstate-lazy-loading-components-angular%2f">
                <svg class="svgIcon-use" width="29" height="29" viewbox="0 0 29 29">
                    <path d="M21.967 11.8c.018 5.93-4.607 11.18-11.177 11.18-2.172 0-4.25-.62-6.047-1.76l-.268.422-.038.5.186.013.168.012c.3.02.44.032.6.046 2.06-.026 3.95-.686 5.49-1.86l1.12-.85-1.4-.048c-1.57-.055-2.92-1.08-3.36-2.51l-.48.146-.05.5c.22.03.48.05.75.08.48-.02.87-.07 1.25-.15l2.33-.49-2.32-.49c-1.68-.35-2.91-1.83-2.91-3.55 0-.05 0-.01-.01.03l-.49-.1-.25.44c.63.36 1.35.57 2.07.58l1.7.04L7.4 13c-.978-.662-1.59-1.79-1.618-3.047a4.08 4.08 0 0 1 .524-1.8l-.825.07a12.188 12.188 0 0 0 8.81 4.515l.59.033-.06-.59v-.02c-.05-.43-.06-.63-.06-.87a3.617 3.617 0 0 1 6.27-2.45l.2.21.28-.06c1.01-.22 1.94-.59 2.73-1.09l-.75-.56c-.1.36-.04.89.12 1.36.23.68.58 1.13 1.17.85l-.21-.45-.42-.27c-.52.8-1.17 1.48-1.92 2L22 11l.016.28c.013.2.014.35 0 .52v.04zm.998.038c.018-.22.017-.417 0-.66l-.498.034.284.41a8.183 8.183 0 0 0 2.2-2.267l.97-1.48-1.6.755c.17-.08.3-.02.34.03a.914.914 0 0 1-.13-.292c-.1-.297-.13-.64-.1-.766l.36-1.254-1.1.695c-.69.438-1.51.764-2.41.963l.48.15a4.574 4.574 0 0 0-3.38-1.484 4.616 4.616 0 0 0-4.61 4.613c0 .29.02.51.08.984l.01.02.5-.06.03-.5c-3.17-.18-6.1-1.7-8.08-4.15l-.48-.56-.36.64c-.39.69-.62 1.48-.65 2.28.04 1.61.81 3.04 2.06 3.88l.3-.92c-.55-.02-1.11-.17-1.6-.45l-.59-.34-.14.67c-.02.08-.02.16 0 .24-.01 2.12 1.55 4.01 3.69 4.46l.1-.49-.1-.49c-.33.07-.67.12-1.03.14-.18-.02-.43-.05-.64-.07l-.76-.09.23.73c.57 1.84 2.29 3.14 4.28 3.21l-.28-.89a8.252 8.252 0 0 1-4.85 1.66c-.12-.01-.26-.02-.56-.05l-.17-.01-.18-.01L2.53 21l1.694 1.07a12.233 12.233 0 0 0 6.58 1.917c7.156 0 12.2-5.73 12.18-12.18l-.002.04z"></path>
                </svg>
            </a>
        </li>
        <li>
            <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fjuristr.com%2fblog%2f2019%2f04%2fstate-lazy-loading-components-angular%2f">
                <svg class="svgIcon-use" width="29" height="29" viewbox="0 0 29 29">
                    <path d="M16.39 23.61v-5.808h1.846a.55.55 0 0 0 .546-.48l.36-2.797a.551.551 0 0 0-.547-.62H16.39V12.67c0-.67.12-.813.828-.813h1.474a.55.55 0 0 0 .55-.55V8.803a.55.55 0 0 0-.477-.545c-.436-.06-1.36-.116-2.22-.116-2.5 0-4.13 1.62-4.13 4.248v1.513H10.56a.551.551 0 0 0-.55.55v2.797c0 .304.248.55.55.55h1.855v5.76c-4.172-.96-7.215-4.7-7.215-9.1 0-5.17 4.17-9.36 9.31-9.36 5.14 0 9.31 4.19 9.31 9.36 0 4.48-3.155 8.27-7.43 9.15M14.51 4C8.76 4 4.1 8.684 4.1 14.46c0 5.162 3.75 9.523 8.778 10.32a.55.55 0 0 0 .637-.543v-6.985a.551.551 0 0 0-.55-.55H11.11v-1.697h1.855a.55.55 0 0 0 .55-.55v-2.063c0-2.02 1.136-3.148 3.03-3.148.567 0 1.156.027 1.597.06v1.453h-.924c-1.363 0-1.93.675-1.93 1.912v1.78c0 .3.247.55.55.55h2.132l-.218 1.69H15.84c-.305 0-.55.24-.55.55v7.02c0 .33.293.59.623.54 5.135-.7 9.007-5.11 9.007-10.36C24.92 8.68 20.26 4 14.51 4"></path>
                </svg>
            </a>
        </li>
    </ul>
    
</div></div>
        
        <div class="col-md-9 col-md-offset-2 col-xs-12">
            <div class="mainheading">

                
                
                
                
                <div class="row post-top-meta">
                    
                    <div class="col-md-2">
                        <img class="author-thumb" src="https://www.gravatar.com/avatar/64537dfe80f44978663e378d375c7138?s=150&amp;d=identicon&amp;r=PG" alt="Juri Strumpflohner">
                    </div>
                    <div class="col-md-10">
                        <a class="link-dark" href="/about/">Juri Strumpflohner</a><a href="https://twitter.com/@juristr"
                            class="btn follow">Follow</a>
                        <span class="author-description">Juri is a full stack developer and tech lead with a special passion for the web and frontend development. He creates online videos for <a href="https://egghead.io/instructors/juri-strumpflohner">Egghead.io</a>, writes articles on his blog and for tech magazines, speaks at conferences and holds training workshops. Juri is also a recognized Google Developer Expert in Web Technologies</span>
                        
                    </div>
                    
                </div>
                
                
                
                

                <h1 class="posttitle">Lazy load Angular Components</h1>
                
                <h2 class="article-subtitle">Or better..how to lazy load Angular Modules. Learn about the state of lazy loading and lazy loading on steroids with Angular Elements</h2>
                
                <p>
                    <span class="post-date">
                        <time class="post-date">
                            Apr 29, 2019
                        </time></span>
                    <span class="dot"></span>
                    <span class="post-read">14 min read</span>
                </p>
            </div>

            
            
            

            
            <a href="https://egghead.io/courses/productive-git-for-developers?af=fj2vsx" class="external-link" data-client="eggheadio" data-uid="url">
                <img src="/assets/images/banners/egghead-banner-productive-git.png" style="width:100%" />
            </a>
            

            
            <div class="article-post">
                

<div class="article-intro">
    Lazy loading is hot recently and for a good reason. It&rsquo;s all about speed! The Chrome team at Google in specific (around Addy Osmani) tries to push out content (and new APIs) to optimize the heck out of web pages. Now there&rsquo;s one thing modern, JavaScript heavy websites often suffer: startup speed. Improving the startup time of these new modern apps is crucial for getting a high quality app, UX and even gaining better SEO. There are different strategies we can apply to help with that. Reducing the app&rsquo;s bundle size is one way to help with that and that&rsquo;s also where lazy loading comes into play. Right now the most popular way of lazy loading is for sure using Angular routes. In this article however we&rsquo;re going to explore some further options, also powered by Angular Elements.
</div>

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9669473064376287" data-ad-slot="2496274486"
    data-ad-format="auto"></ins>
<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>

<hr />
<div class="article-toc">
    <strong>Table of contents</strong>
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#what-means-lazy-loading-after-all">What means lazy loading after all?</a></li>
<li><a href="#what-can-be-lazy-loaded">What can be lazy loaded?</a></li>
<li><a href="#lazy-loading-angular-routes">Lazy Loading Angular Routes</a>
<ul>
<li><a href="#egghead-lessons-on-lazy-loading-and-preloading">Egghead lessons on lazy loading and preloading</a></li>
</ul></li>
<li><a href="#manual-lazy-loading-of-modules">Manual Lazy Loading of Modules</a>
<ul>
<li><a href="#compiling-the-module-into-a-dedicated-js-bundle">Compiling the module into a dedicated JS bundle</a></li>
<li><a href="#loading-the-module-at-runtime">Loading the module at runtime</a></li>
<li><a href="#finally-dynamically-instantiating-the-component">Finally, dynamically instantiating the component</a></li>
</ul></li>
<li><a href="#lazy-loading-with-angular-elements">Lazy Loading with Angular Elements</a>
<ul>
<li><a href="#intro-to-angular-elements">Intro to Angular Elements</a></li>
<li><a href="#lazy-loading-angular-elements">Lazy loading &amp; Angular Elements?</a></li>
</ul></li>
<li><a href="#automatic-lazy-loading-with-angular-elements">Automatic lazy loading with Angular Elements</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul></li>
</ul>
</nav>
</div>
<hr />

<h2 id="what-means-lazy-loading-after-all">What means lazy loading after all?</h2>

<p>While single-page applications tend to be fast once they are loaded, their initial load time often suffers. This is because of the huge amount of JavaScript that needs to be downloaded, parsed and interpreted by the browser only for then delegating the whole rendering to the SPA JavaScript app. As you can see this differs quite a lot from classic server-side rendered apps, where the HTML is already ready to be rendered by the browser. As a result we need to optimize for that. One approach is to make the main JavaScript bundle - necessary for booting the app (for Angular apps usually <code>main.js</code>) - become as small as possible, so that our app can boot up really fast. This is when &ldquo;lazy loading&rdquo; comes into play. And with lazy loading <strong>we</strong> really mean to defer loading unused bits &amp; just <strong>load them on demand</strong>.</p>

<blockquote class="emphasized">"Lazy loading = loading on demand"</blockquote>

<p>Say we have the &ldquo;settings&rdquo; area in our app where the user can specify certain configurations. We know the users only rarely enter these areas. As a result, we want to defer the loading of the corresponding JavaScript for that area as much as possible. Maybe we don&rsquo;t even load it at all. At the latest, when the user clicks on the corresponding menu item, we can execute a HTTP request, fetch the JavaScript file and load up that section of the app.</p>

<p>Now, for this to work, all our compiled TypeScript code for that &ldquo;settings&rdquo; area of our app needs to be isolated and compiled into a dedicated JavaScript file that gets deployed separately along all the other assets, right? That&rsquo;s required such that we can then fetch that specific file at runtime, when needed. Sounds complex 🤔, but luckily Angular is build on great tooling (looking at you Webpack 😉), which does this file bundling for us 😃.</p>

<h2 id="what-can-be-lazy-loaded">What can be lazy loaded?</h2>

<p>Great, so now we know what lazy loading is, but before we dive straight in, let&rsquo;s first define <strong>what can be lazy loaded</strong> in an Angular application. You might be tempted to say &ldquo;I want to lazy load an Angular component&rdquo;, right? After all that&rsquo;s what you want to visualize at a given moment. However, that&rsquo;s not entirely possible.</p>

<p>The basic unit in Angular is a <strong>module</strong>. If you think about your Angular components, they have dependencies on other components, like Angular Material. But the component itself doesn&rsquo;t specify those dependencies. Rather components are all registered on modules which are then connected between them. As of now (Angular version 7), modules are necessary for Angular in order to &ldquo;know&rdquo; how your code works, which dependencies are needed, which components are used in the templates.</p>

<p>Therefore&hellip;</p>

<blockquote class="emphasized">"The basic unit that can be lazy loaded are <strong>NgModules</strong>"</blockquote>

<p>And with them - of course - come the bundled components which we&rsquo;re ultimately interested in.</p>

<h2 id="lazy-loading-angular-routes">Lazy Loading Angular Routes</h2>

<p>Probably the most easy and most widespread usage of lazy loading in Angular apps right now is <strong>via routes</strong>.</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="kr">const</span> <span class="nx">routes</span>: <span class="kt">Routes</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span>
    <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="nx">redirectTo</span><span class="o">:</span> <span class="s1">&#39;home&#39;</span><span class="p">,</span>
    <span class="nx">pathMatch</span><span class="o">:</span> <span class="s1">&#39;full&#39;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;home&#39;</span><span class="p">,</span>
    <span class="nx">loadChildren</span><span class="o">:</span> <span class="s1">&#39;./home/home.module#HomeModule&#39;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;issues&#39;</span><span class="p">,</span>
    <span class="nx">loadChildren</span><span class="o">:</span> <span class="s1">&#39;./issue-list/issue-list.module#IssueListModule&#39;</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;search&#39;</span><span class="p">,</span>
    <span class="nx">loadChildren</span><span class="o">:</span> <span class="s1">&#39;./search/search.module#SearchModule&#39;</span>
  <span class="p">}</span>
<span class="p">];</span></code></pre></div>
<p>Here&rsquo;s an example of a lazy loaded configuration. Rather than specifying the component in the route configuration, we specify the relative path to the module to load, in the form of a string value. Why a string value? The reason is that we cannot use the <code>component</code> property as you do with non-lazy routes, because that implies importing the according component type from a file, thus &ldquo;hard-wiring&rdquo; it together. As a result it would not be lazy any more 😃.</p>

<blockquote>
<p><strong>Also note</strong>, these &ldquo;magic strings&rdquo; will <a href="https://github.com/angular/angular/commit/c61df39">change in Angular v8</a>, allowing us to load them using the <code>import</code> syntax, like <code>loadChildren: () =&gt; import('./lazy-route/lazy.module').then(mod =&gt; mod.LazyModule)</code></p>
</blockquote>

<p>Great, when you then re-launch the Angular CLI compilation process, you may immediately note that you get more JavaScript files being produced and not just the standard <code>main.js</code>, <code>runtime.js</code>, &hellip; Note the <code>home-home.module.js</code>, <code>search-search.module.js</code> etc.</p>

<figure>
  <a href="/blog/assets/imgs/lazy-loaded-bundling-cli.png" class="image--zoom">
    <img src="/blog/assets/imgs/lazy-loaded-bundling-cli.png">
  </a>
  <figcaption>One bundle per lazy loaded file produced by the CLI. Note the issue-list-issue-list-module.js etc..</figcaption>
</figure>

<h3 id="egghead-lessons-on-lazy-loading-and-preloading">Egghead lessons on lazy loading and preloading</h3>

<p><strong>Lazy load a route with the Angular router</strong>
<div class="egghead-video-embed">
    <iframe src="https://egghead.io/lessons/angular-lazy-load-a-route-with-the-angular-router/embed?af=fj2vsx" width="100%" height="500px" loading="lazy"> </iframe>
    <a href="https://egghead.io/lessons/angular-lazy-load-a-route-with-the-angular-router?af=fj2vsx" class="external-link" data-client="eggheadio" data-uid="lessons/angular-lazy-load-a-route-with-the-angular-router">View
        on
        Egghead.io</a>
</div></p>

<p><strong>Avoid delays for lazy modules by applying a preloading strategy with the Angular router</strong>
<div class="egghead-video-embed">
    <iframe src="https://egghead.io/lessons/angular-avoid-delays-for-lazy-modules-by-applying-a-preloading-strategy-with-the-angular-router/embed?af=fj2vsx" width="100%" height="500px" loading="lazy"> </iframe>
    <a href="https://egghead.io/lessons/angular-avoid-delays-for-lazy-modules-by-applying-a-preloading-strategy-with-the-angular-router?af=fj2vsx" class="external-link" data-client="eggheadio" data-uid="lessons/angular-avoid-delays-for-lazy-modules-by-applying-a-preloading-strategy-with-the-angular-router">View
        on
        Egghead.io</a>
</div></p>

<p><strong>Define a custom preloading strategy for the Angular router</strong>
<div class="egghead-video-embed">
    <iframe src="https://egghead.io/lessons/angular-define-a-custom-preloading-strategy-for-the-angular-router/embed?af=fj2vsx" width="100%" height="500px" loading="lazy"> </iframe>
    <a href="https://egghead.io/lessons/angular-define-a-custom-preloading-strategy-for-the-angular-router?af=fj2vsx" class="external-link" data-client="eggheadio" data-uid="lessons/angular-define-a-custom-preloading-strategy-for-the-angular-router">View
        on
        Egghead.io</a>
</div></p>

<h2 id="manual-lazy-loading-of-modules">Manual Lazy Loading of Modules</h2>

<p>But what about when we need a more fine-grained control over lazy loading, and not just with routes? What if we want to open a dialog for instance, and lazy load its containing component just when the user decides to open that specific dialog?<br />
Let&rsquo;s assume we want to lazy load a component called <code>UserListComponent</code>. First, we isolate it in an NgModule since that&rsquo;s our unit of lazy loading (if you remember).</p>

<h3 id="compiling-the-module-into-a-dedicated-js-bundle">Compiling the module into a dedicated JS bundle</h3>

<div class="warn-notice">
    <strong>Update:</strong> if you are on Angular v8+ and you use the new dynamic import feature (<code>import('./some.module').then(m =&gt; m.SomeModule)</code> the code splitting is done automatically and there&rsquo;s no need to specify the <code>lazyModules</code> array in the <code>angular.json</code>
</div>

<p>Now we need to figure out how to <strong>lazy load the Angular Module</strong>. But before starting, we need to make sure our module gets compiled into a separate JS file that can then be lazy loaded. For the routing, the Angular CLI makes sure to create that bundle whenever it sees a <code>loadChildren</code> and according path. For our own non-routed NgModule, we need to take care about that part ourselves. We <strong>need to tell the CLI explicitly</strong> which modules should be bundled separately. This can be done in the <code>angular.json</code>, by adding the path of the lazy module to the <code>lazyModules</code> array. Here&rsquo;s an example.</p>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="err">...</span>
  <span class="nt">&#34;projects&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;issue-tracker&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="err">...</span>
      <span class="nt">&#34;architect&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;build&#34;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&#34;builder&#34;</span><span class="p">:</span> <span class="s2">&#34;@angular-devkit/build-angular:browser&#34;</span><span class="p">,</span>
          <span class="nt">&#34;options&#34;</span><span class="p">:</span> <span class="p">{</span>
            <span class="err">...</span>
            <span class="nt">&#34;lazyModules&#34;</span><span class="p">:</span> <span class="p">[</span>
              <span class="s2">&#34;src/app/shared-components/users/users.module&#34;</span>
            <span class="p">]</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>
<h3 id="loading-the-module-at-runtime">Loading the module at runtime</h3>

<div class="warn-notice">
    <strong>Update:</strong> starting with Angular v8+ the <code>NgModuleFactoryLoader</code> has been deprecated. <a href="/blog/2019/10/lazyload-module-ivy-viewengine/">Read this article</a> to see how to manually lazy load NgModules in ViewEngine and Ivy starting from Angular v8+.
</div>

<p>Once the compilation process is configured, we need to make sure we&rsquo;re able to load the corresponding module JS file at runtime and boot it.<br />
Angular gives us the <code>NgModuleFactoryLoader</code> for that. Here&rsquo;s a quick example of a <code>LazyModuleService</code> I created, that takes a path to a module and loads it accordingly.</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Injectable</span><span class="p">,</span> <span class="nx">NgModuleFactoryLoader</span><span class="p">,</span> <span class="nx">Injector</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>

<span class="kd">@Injectable</span><span class="p">({</span>
  <span class="nx">providedIn</span><span class="o">:</span> <span class="s1">&#39;root&#39;</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">LazyModuleService</span> <span class="p">{</span>

  <span class="kr">constructor</span><span class="p">(</span>
    <span class="kr">private</span> <span class="nx">loader</span>: <span class="kt">NgModuleFactoryLoader</span><span class="p">,</span>
    <span class="kr">private</span> <span class="nx">injector</span>: <span class="kt">Injector</span>
  <span class="p">)</span> <span class="p">{}</span>

  <span class="nx">loadModule</span><span class="p">(</span><span class="nx">path</span>: <span class="kt">string</span><span class="p">)</span><span class="o">:</span> <span class="nx">Promise</span><span class="o">&lt;</span><span class="nx">HTMLElement</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">loader</span>
      <span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kr">module</span><span class="nx">Factory</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="kr">module</span><span class="nx">Ref</span> <span class="o">=</span> <span class="kr">module</span><span class="nx">Factory.create</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">injector</span><span class="p">).</span><span class="nx">instance</span><span class="p">;</span>
        
        <span class="c1">// TODO: do something interesting with the module
</span><span class="c1"></span>
      <span class="p">})</span>
      <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;error loading module&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
      <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>
<p><strong>But we&rsquo;re not done yet.</strong> Remember, in the end <strong>we&rsquo;re interested in visualizing the component</strong> in a lazy fashion. Loading the NgModule is just a means to achieve that.</p>

<h3 id="finally-dynamically-instantiating-the-component">Finally, dynamically instantiating the component</h3>

<p>What&rsquo;s missing is to instantiate the component dynamically. For that we need to get hold of the component type and then using a <code>ComponentFactoryResolver</code> we can instantiate the component accordingly and attach it to the view. Anyways, if you want to go into the details, I have an entire article on that for you 😉</p>

<div class="article-link card">
    <div class="row">
        <div class="col-2 share-link">
            <a href="/blog/2017/07/ng2-dynamic-tab-component/" target="_blank">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-8 mr-4 icon-external-window">
                    <path class="primary" d="M12 8a1 1 0 0 1-1 1H5v10h10v-6a1 1 0 0 1 2 0v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V9c0-1.1.9-2 2-2h6a1 1 0 0 1 1 1z"></path>
                    <path class="secondary" d="M19 6.41L8.7 16.71a1 1 0 1 1-1.4-1.42L17.58 5H14a1 1 0 0 1 0-2h6a1 1 0 0 1 1 1v6a1 1 0 0 1-2 0V6.41z"></path>
                </svg>
            </a>
        </div>
        <div class="col-10">
            <div class="title"><a href="/blog/2017/07/ng2-dynamic-tab-component/" target="_blank">Create a dynamic tab component with Angular</a></div>
            <div class="description">Learn about advanced topics such as dynamic components, ComponentFactoryResolver, ViewContainerRef, ngTemplateOutlet and much more...</div>
            <div class="link">
                /blog/2017/07/ng2-dynamic-tab-component/
            </div>
        </div>
    </div>
</div>

<p>But we don&rsquo;t have to do it by ourselves. <a href="https://twitter.com/aaronfrost">Aaron Frost</a> and his crew of <a href="https://twitter.com/herodevs">herodevs</a> created a small library that handles it for you, check it out: <a href="https://www.npmjs.com/package/@herodevs/lazy-af">@herodevs/lazy-af</a>.<br />
The library automates the steps we&rsquo;ve been talking about before. In order to know which of the components to instantiate, the library uses the <code>bootstrap</code> property of the <code>NgModule</code>. As such we need to add our dynamic component there:</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="kr">import</span> <span class="p">{</span> <span class="nx">NgModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">CommonModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/common&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">UserListComponent</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./user-list/user-list.component&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">SharedModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;src/app/shared/shared.module&#39;</span><span class="p">;</span>

<span class="kd">@NgModule</span><span class="p">({</span>
  <span class="nx">declarations</span><span class="o">:</span> <span class="p">[</span><span class="nx">UserListComponent</span><span class="p">],</span>
  <span class="nx">imports</span><span class="o">:</span> <span class="p">[</span><span class="nx">CommonModule</span><span class="p">,</span> <span class="nx">SharedModule</span><span class="p">],</span>
  <span class="nx">exports</span><span class="o">:</span> <span class="p">[</span><span class="nx">UserListComponent</span><span class="p">],</span>
  <span class="nx">bootstrap</span><span class="o">:</span> <span class="p">[</span><span class="nx">UserListComponent</span><span class="p">]</span> <span class="c1">// &lt;==
</span><span class="c1"></span><span class="p">})</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">UsersModule</span> <span class="p">{}</span></code></pre></div>
<p>But <a href="https://www.npmjs.com/package/@herodevs/lazy-af">check out their README</a>, which describes the details 😃 and guides you through the setup step by step.</p>

<h2 id="lazy-loading-with-angular-elements">Lazy Loading with Angular Elements</h2>

<p>Finally, let&rsquo;s come to the <strong>meat of this article</strong>: <strong>lazy loading components</strong> with Angular Elements 🎉.</p>

<h3 id="intro-to-angular-elements">Intro to Angular Elements</h3>

<p>Angular Elements are the new kid on the block in the Angular ecosystem. Elements allows you to automatically convert (or wrap) every Angular Component as &ldquo;Custom Element&rdquo;. Custom Elements are one of the specs under the umbrella term of <strong>Web Components</strong>.</p>

<p>Head over to my other blog article for more details:</p>

<div class="article-link card">
    <div class="row">
        <div class="col-2 share-link">
            <a href="/blog/2019/04/intro-to-angular-elements" target="_blank">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-8 mr-4 icon-external-window">
                    <path class="primary" d="M12 8a1 1 0 0 1-1 1H5v10h10v-6a1 1 0 0 1 2 0v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V9c0-1.1.9-2 2-2h6a1 1 0 0 1 1 1z"></path>
                    <path class="secondary" d="M19 6.41L8.7 16.71a1 1 0 1 1-1.4-1.42L17.58 5H14a1 1 0 0 1 0-2h6a1 1 0 0 1 1 1v6a1 1 0 0 1-2 0V6.41z"></path>
                </svg>
            </a>
        </div>
        <div class="col-10">
            <div class="title"><a href="/blog/2019/04/intro-to-angular-elements" target="_blank">Introduction to Angular Elements</a></div>
            <div class="description">Learn how to automatically convert your Angular Components to native Custom Elements</div>
            <div class="link">
                /blog/2019/04/intro-to-angular-elements
            </div>
        </div>
    </div>
</div>

<p>Other than that, you may want to check out my latest Egghead course on the topic:</p>

<figure class="image--small">
    <a href="https://egghead.io/courses/getting-started-with-angular-elements?af=fj2vsx" target="_blank" class="external-link" data-client="eggheadio" data-uid="courses/getting-started-with-angular-elements">
        <img src="/blog/assets/imgs/egghead-artwork-angular-elements.png">
    </a>
    <figcaption>Click to check out my Egghead course</figcaption>
</figure>

<h3 id="lazy-loading-angular-elements">Lazy loading &amp; Angular Elements?</h3>

<p>But what do Angular Elements have to do with lazy loading? When speaking about Elements, many immediately think about <strong>compiling them into standalone JavaScript files</strong> s.t. they can then be embedded in other frameworks or in &ldquo;micro-app&rdquo; architectures. While that&rsquo;s a totally valid use case, this is by far not the only one. Angular Elements can be extremely powerful to be used within an Angular apps itself. As you probably guessed already, <strong>one of these use cases is for dynamically loading components</strong>.</p>

<blockquote class="emphasized">
  Angular Elements are not just about compiling them into standalone JS files to be used outside of Angular.
</blockquote>

<p>With Angular Elements, we can already <strong>dynamically instantiate and add a component</strong> to our template in an extremely easy fashion: namely just by appending its tag to the DOM:</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="kd">@Component</span><span class="p">({</span>
  <span class="nx">selector</span><span class="o">:</span> <span class="s1">&#39;app-root&#39;</span><span class="p">,</span>
  <span class="nx">template</span><span class="o">:</span> <span class="sb">`
</span><span class="sb">    &lt;h1&gt;Angular Elements&lt;/h1&gt;
</span><span class="sb">    &lt;div id=&#34;container&#34;&gt;&lt;/div&gt;
</span><span class="sb">    &lt;button (click)=&#34;addGreeter()&#34;&gt;Add greeter&lt;/button&gt;
</span><span class="sb">  `</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">AppComponent</span> <span class="p">{</span>
  <span class="nx">addGreeter() {</span>
    <span class="kr">const</span> <span class="nx">container</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;container&#39;</span><span class="p">);</span>
    <span class="nx">container</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;&lt;do-greet&gt;&lt;/do-greet&gt;&#39;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>
<p>Once the tag is in the template, the browser interprets it, and if there&rsquo;s a corresponding custom element registered, it will instantiate it automatically for us. Obviously <code>do-greet</code> needs <a href="https://egghead.io/lessons/angular-transform-an-angular-component-into-a-native-custom-element?af=fj2vsx">to be an Angular Element</a>. But <a href="/blog/2017/07/ng2-dynamic-tab-component/">compared to dynamically instantiating a traditional Angular component dynamically</a>, this is a looot easier. It&rsquo;s just using the <strong>native DOM API</strong>!</p>

<p>Great, so now we know how to dynamically instantiate an Angular Element. However, in order that the Angular Element get properly instantiated when we insert the tag, it has to be registered. We simply package our Angular Element into a module and lazy load it (just as we learned in the previous section).</p>

<blockquote class="emphasized">
  "Lazy loading Angular Elements means packaging them in lazy Angular Modules"
</blockquote>

<p>So in a first step, we create a module with our Angular Element inside a separate module (let&rsquo;s call it) &ldquo;UsersModule&rdquo;.</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="p">...</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">UserListComponent</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./user-list/user-list.component&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">createCustomElement</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/elements&#39;</span><span class="p">;</span>

<span class="kd">@NgModule</span><span class="p">({</span>
  <span class="nx">declarations</span><span class="o">:</span> <span class="p">[</span><span class="nx">UserListComponent</span><span class="p">],</span>
  <span class="nx">imports</span><span class="o">:</span> <span class="p">[</span><span class="nx">CommonModule</span><span class="p">,</span> <span class="nx">SharedModule</span><span class="p">],</span>
  <span class="nx">entryComponents</span><span class="o">:</span> <span class="p">[</span><span class="nx">UserListComponent</span><span class="p">]</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">UsersModule</span> <span class="p">{</span>
  <span class="kr">constructor</span><span class="p">(</span><span class="nx">injector</span>: <span class="kt">Injector</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// registering our Angular Component
</span><span class="c1"></span>    <span class="kr">const</span> <span class="nx">el</span> <span class="o">=</span> <span class="nx">createCustomElement</span><span class="p">(</span><span class="nx">UserListComponent</span><span class="p">,</span> <span class="p">{</span> <span class="nx">injector</span> <span class="p">});</span>
    <span class="nx">customElements</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;app-user-list&#39;</span><span class="p">,</span> <span class="nx">el</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>
<p>We import a <code>UserListComponent</code> which is the one we want to lazy load and define it to be an Angular Element. We now need to lazy load the module programmatically for which I created a helper service <code>ComponentLoaderService</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="c1">// core/component-loader.service.ts
</span><span class="c1"></span><span class="p">...</span>

<span class="kd">@Injectable</span><span class="p">({</span>
  <span class="nx">providedIn</span><span class="o">:</span> <span class="s1">&#39;root&#39;</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">ComponentLoaderService</span> <span class="p">{</span>
  <span class="kr">private</span> <span class="nx">componentRegistry</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;app-user-list&#39;</span><span class="o">:</span> <span class="p">{</span>
      <span class="kr">module</span><span class="nx">Path</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span>
        <span class="kr">import</span><span class="p">(</span><span class="s1">&#39;../users/users.module&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">m</span> <span class="o">=&gt;</span> <span class="nx">m</span><span class="p">.</span><span class="nx">UsersModule</span><span class="p">),</span>
      <span class="kr">module</span><span class="nx">Ref</span><span class="o">:</span> <span class="kc">null</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="kr">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">compiler</span>: <span class="kt">Compiler</span><span class="p">,</span> <span class="kr">private</span> <span class="nx">injector</span>: <span class="kt">Injector</span><span class="p">)</span> <span class="p">{}</span>

<span class="p">}</span></code></pre></div>
<p>As you can see, the service has a component registry, which is nothing more than a map having the component selector as key and an object with the <code>modulePath</code> to load as well as the instantiated module reference (so that we don&rsquo;t re-fetch already instantiated modules). You could of course also use a different data structure such as a <code>Set</code>. This whole configuration map is just for having a nicer API later. It allows us basically to invoke a function <code>loadComponent('app-user-list')</code>, passing it the tag name of the component to load, rather than having to know the module and passing it the entire path to the module itself.</p>

<p>Finally the <code>loadComponent(...)</code> method. Let&rsquo;s paste it in here before explaining it:</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="c1">// core/component-loader.service.ts
</span><span class="c1"></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">Injectable</span><span class="p">,</span> <span class="nx">Injector</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>

<span class="kd">@Injectable</span><span class="p">({</span>
  <span class="nx">providedIn</span><span class="o">:</span> <span class="s1">&#39;root&#39;</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">ComponentLoaderService</span> <span class="p">{</span>
  <span class="p">...</span>

  <span class="nx">loadComponent</span><span class="p">(</span><span class="nx">componentTag</span>: <span class="kt">string</span><span class="p">)</span><span class="o">:</span> <span class="nx">Promise</span><span class="o">&lt;</span><span class="nx">HTMLElement</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">cmpRegistryEntry</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">componentRegistry</span><span class="p">[</span><span class="nx">componentTag</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">cmpRegistryEntry</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span>
        <span class="sb">`Unrecognized component &#34;</span><span class="si">${</span><span class="nx">componentTag</span><span class="si">}</span><span class="sb">&#34;. Make sure it is registered in the component registry`</span>
      <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">cmpRegistryEntry</span><span class="p">.</span><span class="kr">module</span><span class="nx">Ref</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">(</span><span class="nx">resolve</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">componentInstance</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">componentTag</span><span class="p">);</span>
        <span class="nx">resolve</span><span class="p">(</span><span class="nx">componentInstance</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">cmpRegistryEntry</span><span class="p">.</span><span class="kr">module</span><span class="nx">Path</span><span class="p">;</span>

      <span class="k">return</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="p">(</span><span class="nx">path</span><span class="p">()</span> <span class="kr">as</span> <span class="nx">Promise</span><span class="o">&lt;</span><span class="nx">NgModuleFactory</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span> <span class="o">|</span> <span class="nx">Type</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;&gt;</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">elementModuleOrFactory</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">elementModuleOrFactory</span> <span class="k">instanceof</span> <span class="nx">NgModuleFactory</span><span class="p">)</span> <span class="p">{</span>
              <span class="c1">// if ViewEngine
</span><span class="c1"></span>              <span class="k">return</span> <span class="nx">elementModuleOrFactory</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="k">try</span> <span class="p">{</span>
                <span class="c1">// if Ivy
</span><span class="c1"></span>                <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">compiler</span><span class="p">.</span><span class="nx">compileModuleAsync</span><span class="p">(</span><span class="nx">elementModuleOrFactory</span><span class="p">);</span>
              <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">})</span>
          <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kr">module</span><span class="nx">Factory</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="kr">const</span> <span class="kr">module</span><span class="nx">Ref</span> <span class="o">=</span> <span class="kr">module</span><span class="nx">Factory.create</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">injector</span><span class="p">).</span><span class="nx">instance</span><span class="p">;</span>
            <span class="nx">cmpRegistryEntry</span><span class="p">.</span><span class="kr">module</span><span class="nx">Ref</span> <span class="o">=</span> <span class="kr">module</span><span class="nx">Ref</span><span class="p">;</span>

            <span class="c1">// instantiate the component
</span><span class="c1"></span>            <span class="kr">const</span> <span class="nx">componentInstance</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">componentTag</span><span class="p">);</span>
            <span class="nx">resolve</span><span class="p">(</span><span class="nx">componentInstance</span><span class="p">);</span>
          <span class="p">})</span>
          <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;error loading module&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
            <span class="nx">reject</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
          <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>
<p>The method takes a selector and lazy loads its corresponding module + instantiates it. So the first thing it does is to check the selector is actually defined in the &ldquo;component registry&rdquo;. The next part&hellip;</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="k">if</span> <span class="p">(</span><span class="nx">cmpRegistryEntry</span><span class="p">.</span><span class="kr">module</span><span class="nx">Ref</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">(</span><span class="nx">resolve</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">componentInstance</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">componentTag</span><span class="p">);</span>
    <span class="nx">resolve</span><span class="p">(</span><span class="nx">componentInstance</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="p">...</span>
<span class="p">}</span></code></pre></div>
<p>&hellip;verifies whether the <code>moduleRef</code> property has a value. If that&rsquo;s the case, the module has already been instantiated, so we just need to create an instance of our Angular Element using the native browser API and resolve the <code>Promise</code>.</p>

<p>Otherwise we need to load the module that contains the component that should be lazy loaded. The module can directly be lazy loaded by invoking the dynamic import function that is stored in the <code>modulePath</code> of our object. Once the module is loaded, we create it using <code>moduleFactory.create(...)</code> passing it the injector. Finally, we again instantiate our Angular Element and return it (by resolving our Promise).</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="p">...</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">cmpRegistryEntry</span><span class="p">.</span><span class="kr">module</span><span class="nx">Ref</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">...</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">cmpRegistryEntry</span><span class="p">.</span><span class="kr">module</span><span class="nx">Path</span><span class="p">;</span>

  <span class="k">return</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">loader</span>
      <span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kr">module</span><span class="nx">Factory</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="kr">module</span><span class="nx">Ref</span> <span class="o">=</span> <span class="kr">module</span><span class="nx">Factory.create</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">injector</span><span class="p">).</span><span class="nx">instance</span><span class="p">;</span>
        <span class="nx">cmpRegistryEntry</span><span class="p">.</span><span class="kr">module</span><span class="nx">Ref</span> <span class="o">=</span> <span class="kr">module</span><span class="nx">Ref</span><span class="p">;</span>

        <span class="c1">// instantiate the component
</span><span class="c1"></span>        <span class="kr">const</span> <span class="nx">componentInstance</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">componentTag</span><span class="p">);</span>
        <span class="nx">resolve</span><span class="p">(</span><span class="nx">componentInstance</span><span class="p">);</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;error loading module&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="nx">reject</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span></code></pre></div>
<blockquote>
<p><strong>Note,</strong> if you wanna learn more about how to programmatically load an Angular module, check out <a href="/blog/2019/10/lazyload-module-ivy-viewengine/">my dedicated article here</a> that goes into the details how to lazy load modules s.t. they are compatible with ViewEngine and Ivy.</p>
</blockquote>

<p><strong>How do we use this?</strong> At some other place of our app - for instance the <code>AppComponent</code> - we simply inject our <code>ComponentLoaderService</code> and invoke its <code>loadComponent</code> function passing the selector of the component we wish to lazy load. Once the returning Promise resolves, we have an instance of the component and can pass data to it. In the code below we pass an array of users to its <code>users</code> input property. Finally, using the <code>ElementRef</code> we query for some <code>&lt;div id=&quot;user-container&quot;&gt;</code> and append our Angular Element.</p>
<div class="highlight"><pre class="chroma"><code class="language-typescript" data-lang="typescript"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">AppComponent</span> <span class="p">{</span>
  <span class="nx">title</span> <span class="o">=</span> <span class="s1">&#39;Lazy Loading Elements&#39;</span><span class="p">;</span>

  <span class="kr">constructor</span><span class="p">(</span>
    <span class="kr">private</span> <span class="nx">componentLoader</span>: <span class="kt">ComponentLoaderService</span><span class="p">,</span>
    <span class="kr">private</span> <span class="nx">elementRef</span>: <span class="kt">ElementRef</span>
  <span class="p">)</span> <span class="p">{}</span>

  <span class="nx">onLoadUsers() {</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">componentLoader</span><span class="p">.</span><span class="nx">loadComponent</span><span class="p">(</span><span class="s1">&#39;app-user-list&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">componentEl</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">componentEl</span><span class="p">[</span><span class="s1">&#39;users&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Juri&#39;</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Steffi&#39;</span>
        <span class="p">}</span>
      <span class="p">];</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">elementRef</span><span class="p">.</span><span class="nx">nativeElement</span>
        <span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#user-container&#39;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">componentEl</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>
<p>Unfortunately the code-splitting and lazy loading example does not work on Stackblitz. You can see the whole code on this GitHub repo however: <a href="https://github.com/juristr/ng-element-lazy-manual">https://github.com/juristr/ng-element-lazy-manual</a></p>

<h2 id="automatic-lazy-loading-with-angular-elements">Automatic lazy loading with Angular Elements</h2>

<p>Wait! We could automated that whole stuff and put it into a library!! Exactly, I&rsquo;ve already done that and I&rsquo;ll post about it in my upcoming article. Keep an eye on my blog, subscribe to its feed or simply follow me on <a href="https://twitter.com/juristr">Twitter</a> for more updates 😉.</p>

<h2 id="conclusion">Conclusion</h2>

<p>In this article we&rsquo;ve seen various approaches for lazy loading Angular modules and ultimately the components they contain.</p>

<ul>
<li>Lazy loading via Angular routing</li>
<li>configure the Angular CLI to automatically bundle Angular Modules as separate JavaScript files</li>
<li>Lazy load Angular modules manually using the <code>NgModuleFactoryLoader</code></li>
<li>Lazy loading Angular Components using the <code>lazy-af</code> npm library</li>
<li>Lazy loading Angular Components using Angular Elements</li>
</ul>

<p>There are pros and cons to each of them. In my next article we&rsquo;re going to look into how we can even optimize the lazy loading of Angular Elements and package that functionality up as an independent library. Stay tuned 🎉</p>


				<hr />

				Questions? Thoughts? Hit me up <a href="https://twitter.com/juristr" target="_blank">on Twitter</a>
            </div>

            
            <div class="after-post-tags">
                <ul class="tags">
                    
                    <li>
                        <a href="/tags/angular">angular</a>
                    </li>
                    
                    <li>
                        <a href="/tags/performance">performance</a>
                    </li>
                    
                    <li>
                        <a href="/tags/lazy-loading">lazy loading</a>
                    </li>
                    
                    <li>
                        <a href="/tags/videos">videos</a>
                    </li>
                    
                </ul>
            </div>
            

            <a href="https://egghead.io/instructors/juri-strumpflohner" class="external-link" data-client="eggheadio"
                data-uid="egghead-instructor-page">
                <img src="/blog/assets/imgs/egghead-banner-learn-with-me.png" style="width:100%" />
            </a>

            
            
            
        </div>
        
    </div>
</div>

<div class="hideshare"></div>



<div class="related-container">
    <div class="container">
        <div class="row listrecent listrelated">
            
            

            <div class="col-md-4">
<div class="card">
    
    <div class="card-block">
        <h2 class="card-title">
            <a href="/blog/2019/04/intro-to-angular-elements">Introduction to Angular Elements</a>
        </h2>
        <h4 class="card-text">
            Learn how to automatically convert your Angular Components to native Custom Elements
            
        </h4>
        <div class="metafooter">
            <div class="wrapfooter">
                <div class="row">
                    <div class="col-10">
                        
                            <span class="meta-footer-thumb">
                                <a href="/about/">
                                    <img class="author-thumb" src="https://www.gravatar.com/avatar/64537dfe80f44978663e378d375c7138?s=150&amp;d=identicon&amp;r=PG" alt="Juri Strumpflohner">
                                </a>
                            </span>
                            <span class="author-meta">
                                <span class="post-name"><a href="/about/">Juri Strumpflohner</a></span><br />
                                <span class="post-date">Apr 28, 2019</span><span class="dot"></span><span
                                    class="post-read">5 min read</span>
                            </span>
                        
                    </div>
                    <div class="col-2">
                        
                        
                        
                        <span class="post-category-icon">
                            
                            
                                <img src="/assets/images/categories/angular.svg" />
                            
                        </span>
                        
                        
                    </div>
                </div>
            </div>
        </div>
    </div>

    
</div>

            </div>

            

            <div class="col-md-4">
<div class="card">
    
    <div class="card-block">
        <h2 class="card-title">
            <a href="/blog/2019/02/display-server-side-validation-errors-with-angular">Display Server Side Validation Errors with Angular</a>
        </h2>
        <h4 class="card-text">
            Binding server validation errors to your Angular form
            
        </h4>
        <div class="metafooter">
            <div class="wrapfooter">
                <div class="row">
                    <div class="col-10">
                        
                            <span class="meta-footer-thumb">
                                <a href="/about/">
                                    <img class="author-thumb" src="https://www.gravatar.com/avatar/64537dfe80f44978663e378d375c7138?s=150&amp;d=identicon&amp;r=PG" alt="Juri Strumpflohner">
                                </a>
                            </span>
                            <span class="author-meta">
                                <span class="post-name"><a href="/about/">Juri Strumpflohner</a></span><br />
                                <span class="post-date">Feb 7, 2019</span><span class="dot"></span><span
                                    class="post-read">8 min read</span>
                            </span>
                        
                    </div>
                    <div class="col-2">
                        
                        
                        
                        <span class="post-category-icon">
                            
                            
                                <img src="/assets/images/categories/angular.svg" />
                            
                        </span>
                        
                        
                    </div>
                </div>
            </div>
        </div>
    </div>

    
</div>

            </div>

            

            <div class="col-md-4">
<div class="card">
    
    <div class="card-block">
        <h2 class="card-title">
            <a href="/blog/2019/04/setup-for-angular-dev">Setup your Workstation for JavaScript Development</a>
        </h2>
        <h4 class="card-text">
            Learn about the required tools to get started with proper frontend dev
            
        </h4>
        <div class="metafooter">
            <div class="wrapfooter">
                <div class="row">
                    <div class="col-10">
                        
                            <span class="meta-footer-thumb">
                                <a href="/about/">
                                    <img class="author-thumb" src="https://www.gravatar.com/avatar/64537dfe80f44978663e378d375c7138?s=150&amp;d=identicon&amp;r=PG" alt="Juri Strumpflohner">
                                </a>
                            </span>
                            <span class="author-meta">
                                <span class="post-name"><a href="/about/">Juri Strumpflohner</a></span><br />
                                <span class="post-date">Apr 26, 2019</span><span class="dot"></span><span
                                    class="post-read">4 min read</span>
                            </span>
                        
                    </div>
                    <div class="col-2">
                        
                        
                        
                        <span class="post-category-icon">
                            
                            <div class="svgicon" style="width: 140px">
    

    

    

    

    

    

    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-8 mr-4 icon-cog"><path class="primary" d="M6.8 3.45c.87-.52 1.82-.92 2.83-1.17a2.5 2.5 0 0 0 4.74 0c1.01.25 1.96.65 2.82 1.17a2.5 2.5 0 0 0 3.36 3.36c.52.86.92 1.8 1.17 2.82a2.5 2.5 0 0 0 0 4.74c-.25 1.01-.65 1.96-1.17 2.82a2.5 2.5 0 0 0-3.36 3.36c-.86.52-1.8.92-2.82 1.17a2.5 2.5 0 0 0-4.74 0c-1.01-.25-1.96-.65-2.82-1.17a2.5 2.5 0 0 0-3.36-3.36 9.94 9.94 0 0 1-1.17-2.82 2.5 2.5 0 0 0 0-4.74c.25-1.01.65-1.96 1.17-2.82a2.5 2.5 0 0 0 3.36-3.36zM12 16a4 4 0 1 0 0-8 4 4 0 0 0 0 8z"></path><circle cx="12" cy="12" r="2" class="secondary"></circle></svg>
    

    

    

</div><div class="svgicon clean_code"></div>
                            
                        </span>
                        
                        
                    </div>
                </div>
            </div>
        </div>
    </div>

    
</div>

            </div>

            
            

        </div>
    </div>
</div>

<div class="container">
    <div id="comments" class="row justify-content-center mb-5">
        <div class="col-md-8">              
            <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "juristr" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>               
        </div>
    </div>
</div>



<script type="text/javascript" src="//downloads.mailchimp.com/js/signup-forms/popup/unique-methods/embed.js" data-dojo-config="usePlainJson: true, isDebug: false"></script><script type="text/javascript">window.dojoRequire(["mojo/signup-forms/Loader"], function(L) { L.start({"baseUrl":"mc.us4.list-manage.com","uuid":"04e83acc0ba14b18f30435204","lid":"1d83b68321","uniqueMethods":true}) })</script>
<div class="container">
    
<div class="footer">
    <p class="pull-left">
        &copy; Copyright Juri Strumpflohner - All rights reserved
    </p>
    <p class="pull-right">
        Customized Mediumish Theme, originally by <a target="_blank" href="https://www.wowthemes.net">WowThemes.net</a>
    </p>
    <div class="clearfix">
    </div>
</div>


</div>

    </div>

<script src="/js/jquery.min.js"></script>


<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery-throttle-debounce/1.1/jquery.ba-throttle-debounce.min.js"></script>




<script type="text/javascript" src="/js/bundle.js" integrity=""></script>


<script src="/js/jquery.fluidbox.min.js"></script>
<script>
    $('a.image--zoom,.gallery>a').fluidbox();
</script>

<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-416229-12', 'juristr.com');
    ga('require', 'displayfeatures');
    ga('send', 'pageview');
  </script>






    
    <script type="text/javascript">
        window.cookieconsent_options = {
            "message": "This website uses cookies to ensure you get the best experience on our website",
            "dismiss": "Got it!",
            "learnMore": "More info",
            "link": null,
            "theme": "dark-bottom"
        };
    </script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.9/cookieconsent.min.js" defer></script>
    

    
    
    
    <script>
!function(t,e,a,c,x){var s='q';t[s]={publication_id:c,tags:x};
var s=e.createElement(a),r=e.getElementsByTagName(a)[0];s.async=1,s.src=
'https://insights.quiet.ly/app/analytics.min.js',r.parentNode.insertBefore(s,r)}
(window,document,'script','87bcee90-0c51-4a68-a60b-e95df730d1ca','[]');
</script>
    
 <script>
    if (window.netlifyIdentity) {
      window.netlifyIdentity.on("init", user => {
        if (!user) {
          window.netlifyIdentity.on("login", () => {
            document.location.href = "/admin/";
          });
        }
      });
    }
  </script>
</body>

</html>
