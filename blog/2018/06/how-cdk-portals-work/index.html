<!DOCTYPE html>
<html lang="en-us"><head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="generator" content="Hugo 0.53" />
	
	<link rel="shortcut icon" href="/assets/images/sitelogo.jpeg">
	
	<title>In-depth: How do CDK Portals work? | juri.dev</title>
	
	<meta name="description" content="Learn how to implement your own CDK portal for dynamically placing content in Angular apps">
	
	
	<meta name="robots" content="index, follow">

	
	<meta name="author" content="Juri Strumpflohner">
	<link rel="me" href="https://profiles.google.com/104904743888756261987" />
	<link rel="publisher" href='https://plus.google.com/104904743888756261987' />
	<meta property="twitter:account_id" content="14407063" />


	
	<meta name="google-site-verification" content="0_vyoIaeMG1kXR0h-48gy3OaGl8xoiSJsFDxxCTIBMs" />
	<meta name="google-site-verification" content="AvmssSjl_nchNXIqBW8Agb_UjGqvvLP7HXSxBZ9d0cg" />

	
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:site" content="@juristr" />
	<meta name="twitter:creator" content="@juristr" />
	<meta name="twitter:title" content="In-depth: How do CDK Portals work?" />
	
	<meta name="twitter:description" content="Learn how to implement your own CDK portal for dynamically placing content in Angular apps" />
	

	
	<meta name="twitter:image:src" content="https://juristr.com/blog/assets/imgs/portal.jpeg" />
	

	
	<meta property="og:type" content="article" />
	<meta property="og:title" content="In-depth: How do CDK Portals work?" />
	
	<meta property="og:description" content="Learn how to implement your own CDK portal for dynamically placing content in Angular apps" />
	
	
	<meta property="og:image" content="https://juristr.com/blog/assets/imgs/portal.jpeg" />
	
	<meta property="og:url" content="https://juristr.com/blog/2018/06/how-cdk-portals-work" />
	<meta property="og:site_name" content="juristr.com" />

	
	<link rel="alternate" type="application/rss+xml" title="Juri Strumpflohner" href="//feeds.feedburner.com/juristrumpflohner">
	

	
	<link href="/css/bootstrap.min.css" rel="stylesheet">

	
	
	<link href='//fonts.googleapis.com/css?family=Righteous|Roboto:400,700,900|Source+Code+Pro|Lora:400,700,400italic|Material+Icons'
	 rel='stylesheet' type='text/css'>
	

	

	
	
	
	<link rel="stylesheet" href="/scss/main.min.css" integrity="" media="screen">

	

	

	
	
	<link rel="stylesheet" href="/scss/article.min.css" integrity="" media="screen">
	

	
	
	<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>
<body>
<header class="navbar-light bg-white fixed-top mediumnavigation nav-down">
    <div class="container">

        
        <div class="row justify-content-center align-items-center brandrow">

            <div class="col-lg-4 col-md-4 col-xs-12 d-none d-md-block hidden-xs customarea">
                <img src="/assets/images/gde.svg" style="height:23px">
                <a href="https://developers.google.com/community/experts/directory/profile/profile-juri_strumpflohner" style="
                    padding-left: 5px;
                    font-size: 15pt;
                ">GDE
                    for Web Tech</a>
                

            </div>

            <div class="col-lg-4 col-md-4  col-xs-12 text-center logoarea">
                <a class="navbar-brand" href="https://juristr.com/">
                    
                    <span style="font-family:Righteous;">juri.dev</span>
                    
                </a>
                
            </div>

            <div class="col-lg-4 col-md-4  col-xs-12 text-right d-none d-md-block">
                <a href="https://twitter.com/juristr" class="twitter-follow-button" data-show-count="true">Follow me!</a>
                <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
            </div>

        </div>
        

        <div class="navarea">

            <nav class="navbar navbar-toggleable-sm">
                
                <div id="bs4navbar" class="navbar-collapse">
                    
                    <ul id="menu-top-menu" class="navbar-nav col-md-12 justify-content-center">
                        
                        <li class="menu-item ">
                            <a class="nav-link" href="/">Home</a>
                        </li>
                        
                        <li class="menu-item ">
                            <a class="nav-link" href="/blog">Blog</a>
                        </li>
                        
                        <li class="menu-item ">
                            <a class="nav-link" href="/categories">Collections</a>
                        </li>
                        
                        <li class="menu-item ">
                            <a class="nav-link" href="/newsletter">Newsletter</a>
                        </li>
                        
                        <li class="menu-item ">
                            <a class="nav-link" href="https://github.com/juristr/ama">AMA</a>
                        </li>
                        
                        <li class="menu-item ">
                            <a class="nav-link" href="/about">About Me</a>
                        </li>
                        
                    </ul>

                    
                </div>
            </nav>

        </div>

    </div>

</header>

    <div class="site-content">



<div class="container page-container">
    <div class="row">
        
        <div class="col-md-2 pl-0"><div class="share">
    <p>
        Share
    </p>
    <ul>
        <li>
            <a target="_blank" href="https://twitter.com/home?status=Check out this post by @juristr https%3a%2f%2fjuristr.com%2fblog%2f2018%2f06%2fhow-cdk-portals-work%2f">
                <svg class="svgIcon-use" width="29" height="29" viewbox="0 0 29 29">
                    <path d="M21.967 11.8c.018 5.93-4.607 11.18-11.177 11.18-2.172 0-4.25-.62-6.047-1.76l-.268.422-.038.5.186.013.168.012c.3.02.44.032.6.046 2.06-.026 3.95-.686 5.49-1.86l1.12-.85-1.4-.048c-1.57-.055-2.92-1.08-3.36-2.51l-.48.146-.05.5c.22.03.48.05.75.08.48-.02.87-.07 1.25-.15l2.33-.49-2.32-.49c-1.68-.35-2.91-1.83-2.91-3.55 0-.05 0-.01-.01.03l-.49-.1-.25.44c.63.36 1.35.57 2.07.58l1.7.04L7.4 13c-.978-.662-1.59-1.79-1.618-3.047a4.08 4.08 0 0 1 .524-1.8l-.825.07a12.188 12.188 0 0 0 8.81 4.515l.59.033-.06-.59v-.02c-.05-.43-.06-.63-.06-.87a3.617 3.617 0 0 1 6.27-2.45l.2.21.28-.06c1.01-.22 1.94-.59 2.73-1.09l-.75-.56c-.1.36-.04.89.12 1.36.23.68.58 1.13 1.17.85l-.21-.45-.42-.27c-.52.8-1.17 1.48-1.92 2L22 11l.016.28c.013.2.014.35 0 .52v.04zm.998.038c.018-.22.017-.417 0-.66l-.498.034.284.41a8.183 8.183 0 0 0 2.2-2.267l.97-1.48-1.6.755c.17-.08.3-.02.34.03a.914.914 0 0 1-.13-.292c-.1-.297-.13-.64-.1-.766l.36-1.254-1.1.695c-.69.438-1.51.764-2.41.963l.48.15a4.574 4.574 0 0 0-3.38-1.484 4.616 4.616 0 0 0-4.61 4.613c0 .29.02.51.08.984l.01.02.5-.06.03-.5c-3.17-.18-6.1-1.7-8.08-4.15l-.48-.56-.36.64c-.39.69-.62 1.48-.65 2.28.04 1.61.81 3.04 2.06 3.88l.3-.92c-.55-.02-1.11-.17-1.6-.45l-.59-.34-.14.67c-.02.08-.02.16 0 .24-.01 2.12 1.55 4.01 3.69 4.46l.1-.49-.1-.49c-.33.07-.67.12-1.03.14-.18-.02-.43-.05-.64-.07l-.76-.09.23.73c.57 1.84 2.29 3.14 4.28 3.21l-.28-.89a8.252 8.252 0 0 1-4.85 1.66c-.12-.01-.26-.02-.56-.05l-.17-.01-.18-.01L2.53 21l1.694 1.07a12.233 12.233 0 0 0 6.58 1.917c7.156 0 12.2-5.73 12.18-12.18l-.002.04z"></path>
                </svg>
            </a>
        </li>
        <li>
            <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fjuristr.com%2fblog%2f2018%2f06%2fhow-cdk-portals-work%2f">
                <svg class="svgIcon-use" width="29" height="29" viewbox="0 0 29 29">
                    <path d="M16.39 23.61v-5.808h1.846a.55.55 0 0 0 .546-.48l.36-2.797a.551.551 0 0 0-.547-.62H16.39V12.67c0-.67.12-.813.828-.813h1.474a.55.55 0 0 0 .55-.55V8.803a.55.55 0 0 0-.477-.545c-.436-.06-1.36-.116-2.22-.116-2.5 0-4.13 1.62-4.13 4.248v1.513H10.56a.551.551 0 0 0-.55.55v2.797c0 .304.248.55.55.55h1.855v5.76c-4.172-.96-7.215-4.7-7.215-9.1 0-5.17 4.17-9.36 9.31-9.36 5.14 0 9.31 4.19 9.31 9.36 0 4.48-3.155 8.27-7.43 9.15M14.51 4C8.76 4 4.1 8.684 4.1 14.46c0 5.162 3.75 9.523 8.778 10.32a.55.55 0 0 0 .637-.543v-6.985a.551.551 0 0 0-.55-.55H11.11v-1.697h1.855a.55.55 0 0 0 .55-.55v-2.063c0-2.02 1.136-3.148 3.03-3.148.567 0 1.156.027 1.597.06v1.453h-.924c-1.363 0-1.93.675-1.93 1.912v1.78c0 .3.247.55.55.55h2.132l-.218 1.69H15.84c-.305 0-.55.24-.55.55v7.02c0 .33.293.59.623.54 5.135-.7 9.007-5.11 9.007-10.36C24.92 8.68 20.26 4 14.51 4"></path>
                </svg>
            </a>
        </li>
    </ul>
    
</div></div>
        
        <div class="col-md-9 col-md-offset-2 col-xs-12">
            <div class="mainheading">

                
                
                
                
                <div class="row post-top-meta">
                    
                    <div class="col-md-2">
                        <img class="author-thumb" src="https://www.gravatar.com/avatar/64537dfe80f44978663e378d375c7138?s=150&amp;d=identicon&amp;r=PG" alt="Juri Strumpflohner">
                    </div>
                    <div class="col-md-10">
                        <a class="link-dark" href="/about/">Juri Strumpflohner</a><a href="https://twitter.com/@juristr"
                            class="btn follow">Follow</a>
                        <span class="author-description">Juri is a full stack developer and tech lead with a special passion for the web and frontend development. He creates online videos for <a href="https://egghead.io/instructors/juri-strumpflohner">Egghead.io</a>, writes articles on his blog and for tech magazines, speaks at conferences and holds training workshops. Juri is also a recognized Google Developer Expert in Web Technologies</span>
                        
                    </div>
                    
                </div>
                
                
                
                

                <h1 class="posttitle">In-depth: How do CDK Portals work?</h1>
                
                <h2 class="article-subtitle">Learn how to implement your own CDK portal for dynamically placing content in Angular apps</h2>
                
                <p>
                    <span class="post-date">
                        <time class="post-date">
                            Jun 26, 2018
                        </time></span>
                    <span class="dot"></span>
                    <span class="post-read">6 min read</span>
                </p>
            </div>

            
            
            

            
            <a href="https://egghead.io/courses/productive-git-for-developers?af=fj2vsx" class="external-link" data-client="eggheadio" data-uid="url">
                <img src="/assets/images/banners/egghead-banner-productive-git.png" style="width:100%" />
            </a>
            

            
            <div class="article-post">
                

<div class="article-intro">
    <a href="/blog/2018/05/dynamic-UI-with-cdk-portals/">In the last article</a> we were exploring how to <a href="https://material.angular.io/cdk/portal/overview">leverage the Angular Material CDK portals</a> for placing some piece of template from a component to some other location within our app. CDK portals make this a no-brainer. Wondering how they work? In this article we dive deeper to uncover how its internals work and how we could simply implement it by ourselves.<br />
</div>

<figure class="image--full">
    <a href="/blog/assets/imgs/portal.jpeg" class="image--zoom">
        <img src="/blog/assets/imgs/portal.jpeg">
    </a>
    <figcaption>Source: https://unsplash.com/photos/0a5VbkqqFFE</figcaption>
</figure>

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9669473064376287" data-ad-slot="2496274486"
    data-ad-format="auto"></ins>
<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>

<p><div class="warn-notice">
    Contents are based on Angular version &gt;= 5.0.0
</div> {%
include warn-notice.html %}</p>

<hr />
<div class="article-toc">
    <strong>Table of contents</strong>
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#quick-recap-on-cdk-portals">Quick recap on CDK Portals</a></li>
<li><a href="#creating-our-own-templateportal">Creating our own TemplatePortal</a></li>
<li><a href="#creating-our-own-portalhost">Creating our own PortalHost</a></li>
<li><a href="#how-is-angular-able-to-run-change-detection-on-the-embedded-view">How is Angular able to run Change Detection on the embedded view?</a></li>
<li><a href="#putting-all-together-and-attach-it-to-the-dom">Putting all together and attach it to the DOM</a></li>
<li><a href="#cleaning-up">Cleaning up</a></li>
<li><a href="#demo">Demo</a>
<ul>
<li><a href="#related-articles">Related Articles</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
</div>
<hr />

<h2 id="quick-recap-on-cdk-portals">Quick recap on CDK Portals</h2>

<p>As shown in the previous article, we need two parts to render a template into a DOM element: the portal host and portal. In this article we’re going to look into what the portal host and portal actually do and how we can emulate their implementation.</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// Create a portalHost from a DOM element
</span><span class="c1"></span><span class="k">this</span><span class="p">.</span><span class="nx">portalHost</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DomPortalHost</span><span class="p">(</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#page-actions-container&#39;</span><span class="p">),</span>
  <span class="p">...</span>
<span class="p">);</span>

<span class="c1">// create a template portal that takes the reference to
</span><span class="c1">// our ng-template
</span><span class="c1"></span><span class="k">this</span><span class="p">.</span><span class="nx">portal</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TemplatePortal</span><span class="p">(</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">pageActionsTmplRef</span><span class="p">,</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewContainerRef</span>
<span class="p">);</span>

<span class="c1">// Attach portal to host
</span><span class="c1"></span><span class="k">this</span><span class="p">.</span><span class="nx">portalHost</span><span class="p">.</span><span class="nx">attach</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">portal</span><span class="p">);</span>
</code></pre></div>
<p>So the <code>#page-actions-container</code> that we’re passing to our <code>DomPortalHost</code> is the DOM element on our page to which we want to render our content. The next step is to grab the actual content, basically an <code>&lt;ng-template #pageActions&gt;</code>  which we can get a reference to using Angular’s <code>@ViewChild('pageActions')</code> and store it in the <code>pageActionsTmplRef</code> variable.
Once we have that, we can define our TemplatePortal, passing it our reference to the template as well as a reference to the viewContainer, which we simply inject using Angular’s DI.
Finally, we need to attach our “portal” to our “portal host” to render the content on the page.</p>

<h2 id="creating-our-own-templateportal">Creating our own TemplatePortal</h2>

<p>Let’s start with the <code>TemplatePortal</code>. First of all we need to define the view, which in Angular we do in the component’s template:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
    <span class="p">...</span>
    <span class="nx">template</span><span class="o">:</span> <span class="sb">`
</span><span class="sb">      &lt;ng-template #pageActions&gt;
</span><span class="sb">        &lt;button type=&#34;button&#34; ...&gt;
</span><span class="sb">          &lt;mat-icon&gt;add&lt;/mat-icon&gt;
</span><span class="sb">        &lt;/button&gt;
</span><span class="sb">      &lt;/ng-template&gt;
</span><span class="sb">    `</span>
<span class="p">})</span>
<span class="k">export</span> <span class="k">class</span> <span class="nx">PageActionsComponent</span> <span class="p">{...}</span>
</code></pre></div>
<p><code>&lt;ng-template&gt;</code> won’t be rendered by Angular but serves rather as a means to define a view that we can reference. As you can see I applied a so-called “page variable” which can be accessed from within our <code>PageActionsComponent</code> using the <code>ViewChild</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="err">@</span><span class="nx">Component</span><span class="p">({...})</span>
<span class="k">export</span> <span class="k">class</span> <span class="nx">PageActionsComponent</span> <span class="kr">implements</span> <span class="nx">AfterViewInit</span> <span class="p">{</span>
    <span class="err">@</span><span class="nx">ViewChild</span><span class="p">(</span><span class="s1">&#39;pageActions&#39;</span><span class="p">)</span> <span class="nx">portalActionsTmplRef</span><span class="p">;</span>
    
    <span class="nx">ngAfterViewInit</span><span class="p">()</span> <span class="p">{</span>
      <span class="c1">// access the portalActionsTmplRef here
</span><span class="c1"></span>    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>The <code>ViewChild</code> will be accessible in the <a href="https://angular.io/guide/lifecycle-hooks#afterview">ngAfterViewInit lifecycle hook</a>. Having a reference to our ng-template, we now need to create a so-called <a href="https://angular.io/api/core/EmbeddedViewRef">EmbeddedViewRef</a>. An <code>EmbeddedViewRef</code> is a grouping of DOM elements which we can then be passed along to the container (our portal host) where they should ultimately be rendered. To create it, we need to use the <code>createEmbeddedView(..)</code> function of the <a href="https://angular.io/api/core/ViewContainerRef">ViewContainerRef</a>. The latter can just be injected using Angular’s DI:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="err">@</span><span class="nx">Component</span><span class="p">({...})</span>
<span class="k">export</span> <span class="k">class</span> <span class="nx">PageActionsComponent</span> <span class="kr">implements</span> <span class="nx">AfterViewInit</span> <span class="p">{</span>
    <span class="err">@</span><span class="nx">ViewChild</span><span class="p">(</span><span class="s1">&#39;pageActions&#39;</span><span class="p">)</span> <span class="nx">portalActionsTmplRef</span><span class="p">;</span>
    
    <span class="nx">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">viewContainerRef</span><span class="o">:</span> <span class="nx">ViewContainerRef</span><span class="p">)</span> <span class="p">{}</span>
    
    <span class="nx">ngAfterViewInit</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">const</span> <span class="nx">viewRef</span> <span class="o">=</span> <span class="nx">viewContainer</span><span class="p">.</span><span class="nx">createEmbeddedView</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">portalActionsTmplRef</span><span class="p">);</span>
      <span class="nx">viewRef</span><span class="p">.</span><span class="nx">detectChanges</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>We directly pass it our reference to the <code>ng-template</code> into the <code>createEmbeddedView(..)</code> function. Moreover we execute change detection on our in-memory view.</p>

<blockquote>
<p>Note that the <code>createEmbeddedView(..)</code>  takes an optional 2nd parameter, a context object which can be used to pass data to our view being rendered.</p>
</blockquote>

<p>The <code>viewRef</code> variable now contains an in-memory rendered view, allowing us to pass it along to a “Portal host” which is responsible for placing it onto the DOM.</p>

<h2 id="creating-our-own-portalhost">Creating our own PortalHost</h2>

<p>The portal host is nothing too complicated either, but rather just a wrapper around a DOM element serving us as the placeholder where to render our content. As such, it needs to manage</p>

<ul>
<li>the location where to render the view, in the form of a DOM <code>Element</code>.</li>
<li>the template to render, in the form of a <code>TemplateRef</code></li>
</ul>

<p>Implementing our own <code>PortalHost</code> is relatively easy. To <strong>grab an instance of a DOM element</strong>, we can use the native DOM API:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="k">const</span> <span class="nx">outletElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#page-actions-container&#39;</span><span class="p">);</span>
</code></pre></div>
<p>This gives us the DOM element which we can then use to append our view.</p>

<p>We will <strong>get the view to be rendered</strong> from our implementation of the <code>TemplatePortal</code> we’ve seen before, in the form of an <code>EmbeddedViewRef</code>.  The <code>EmbeddedViewRef</code> consists of one or more “nodes”. Take for instance the following view:</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">ng-template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>Hi<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Click me<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">ng-template</span><span class="p">&gt;</span></code></pre></div>
<p>In this case our view consists of a <code>&lt;span&gt;</code> element as well as a <code>&lt;button&gt;</code>, all of which have to be attached to the target DOM element (in our case <code>outletElement</code>).</p>

<p>Luckily the <code>EmbeddedViewRef</code>, has a property <code>rootNodes</code> which is an array of all the DOM elements it embraces. Thus, we can iterate over that array, and leverage the <code>appendChild(…)</code> function on our <code>outletElement</code> to insert the various nodes into the DOM:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// viewRef is the variable containing our instance of
</span><span class="c1">// the EmbeddedViewRef
</span><span class="c1"></span><span class="nx">viewRef</span><span class="p">.</span><span class="nx">rootNodes</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">rootNode</span> <span class="p">=&gt;</span> <span class="nx">outletElement</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">rootNode</span><span class="p">));</span>
</code></pre></div>
<h2 id="how-is-angular-able-to-run-change-detection-on-the-embedded-view">How is Angular able to run Change Detection on the embedded view?</h2>

<p>If you paid attention, then you&rsquo;ve seen that we&rsquo;re creating the <code>EmbeddedViewRef</code> using an instance of the <code>ViewContainerRef</code> that we get via Angular&rsquo;s dependency injection from the <code>PageActionsComponent</code>. That view container is actually part of the <code>PageActionsComponent</code> and as a result, also our embedded view.</p>

<p>It just happens, that in our case the nodes of the <code>EmbeddedViewRef</code> are rendered somewhere else on the page, namely inside our <code>outletElement</code>. Still, whenever Angular runs CD on our <code>PageActionsComponent</code>, it will execute it as well on our embedded view ref.</p>

<div class="article-link card">
    <div class="row">
        <div class="col-2 share-link">
            <a href="https://blog.angularindepth.com/working-with-dom-in-angular-unexpected-consequences-and-optimization-techniques-682ac09f6866" target="_blank">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-8 mr-4 icon-external-window">
                    <path class="primary" d="M12 8a1 1 0 0 1-1 1H5v10h10v-6a1 1 0 0 1 2 0v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V9c0-1.1.9-2 2-2h6a1 1 0 0 1 1 1z"></path>
                    <path class="secondary" d="M19 6.41L8.7 16.71a1 1 0 1 1-1.4-1.42L17.58 5H14a1 1 0 0 1 0-2h6a1 1 0 0 1 1 1v6a1 1 0 0 1-2 0V6.41z"></path>
                </svg>
            </a>
        </div>
        <div class="col-10">
            <div class="title"><a href="https://blog.angularindepth.com/working-with-dom-in-angular-unexpected-consequences-and-optimization-techniques-682ac09f6866" target="_blank">Working with DOM in Angular: unexpected consequences and optimization techniques</a></div>
            <div class="description">Deep dive into working with DOM in Angular and learn about the difference between embedded views and host views</div>
            <div class="link">
                https://blog.angularindepth.com/working-with-dom-in-angular-unexpected-consequences-and-optimization-techniques-682ac09f6866
            </div>
        </div>
    </div>
</div>

<h2 id="putting-all-together-and-attach-it-to-the-dom">Putting all together and attach it to the DOM</h2>

<p>We have now all the pieces together, the functionality of the <code>TemplatePortal</code> as well as the <code>PortalHost</code>. If we put all of them together in our <code>ngAfterViewInit(..)</code> it could look as simple as this:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">ngAfterViewInit</span><span class="p">()</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
  <span class="c1">// render the View
</span><span class="c1"></span>  <span class="k">const</span> <span class="nx">viewRef</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewContainerRef</span><span class="p">.</span><span class="nx">createEmbeddedView</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">portalActionsTmplRef</span><span class="p">);</span>
  <span class="nx">viewRef</span><span class="p">.</span><span class="nx">detectChanges</span><span class="p">();</span>

  <span class="c1">// grab the DOM element
</span><span class="c1"></span>  <span class="k">const</span> <span class="nx">outletElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#page-actions-container&#39;</span><span class="p">);</span>
  
  <span class="c1">// attach the view to the DOM element that matches our selector
</span><span class="c1"></span>  <span class="nx">viewRef</span><span class="p">.</span><span class="nx">rootNodes</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">rootNode</span> <span class="p">=&gt;</span> <span class="nx">outletElement</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">rootNode</span><span class="p">));</span>
  <span class="p">...</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="cleaning-up">Cleaning up</h2>

<p>Clearly, we should also take care of removing again the elements from the DOM, whenever the parent component gets destroyed. To remove an attached view, the <code>remove(index)</code> function of the <code>ViewContainer</code> an be used.</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">ngOnDestroy</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// get the index of where our view resides inside the
</span><span class="c1"></span>  <span class="c1">// ViewContainer
</span><span class="c1"></span>  <span class="k">const</span> <span class="nx">index</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewContainer</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewRef</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewContainer</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">index</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="demo">Demo</h2>

<p>Wrapping up, I changed the adapted <a href="/blog/2018/05/dynamic-UI-with-cdk-portals/">the implementation from the previous article using CDKPortals</a> to rather use our own implementation of portals. You can find the entire source code on Stackblitz.</p>

<p><em>Hint: open the <code>src/app/shared/page-actions/page-actions.component.ts</code> file.</em></p>

<p>{% assign uid = &ldquo;github/juristr/demo-cdk-portal-mobile-pageactions/tree/self-made-portals&rdquo; %}</p>

<h3 id="related-articles">Related Articles</h3>

<div class="article-link card">
    <div class="row">
        <div class="col-2 share-link">
            <a href="/blog/2017/11/dynamic-angular-components-for-rendering-html/" target="_blank">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-8 mr-4 icon-external-window">
                    <path class="primary" d="M12 8a1 1 0 0 1-1 1H5v10h10v-6a1 1 0 0 1 2 0v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V9c0-1.1.9-2 2-2h6a1 1 0 0 1 1 1z"></path>
                    <path class="secondary" d="M19 6.41L8.7 16.71a1 1 0 1 1-1.4-1.42L17.58 5H14a1 1 0 0 1 0-2h6a1 1 0 0 1 1 1v6a1 1 0 0 1-2 0V6.41z"></path>
                </svg>
            </a>
        </div>
        <div class="col-10">
            <div class="title"><a href="/blog/2017/11/dynamic-angular-components-for-rendering-html/" target="_blank">Use Dynamic Components to render HTML for 3rd party libraries</a></div>
            <div class="description">Leverage dynamic components to render HTML for a Leaflet popup message</div>
            <div class="link">
                /blog/2017/11/dynamic-angular-components-for-rendering-html/
            </div>
        </div>
    </div>
</div>

<div class="article-link card">
    <div class="row">
        <div class="col-2 share-link">
            <a href="/blog/2017/07/ng2-dynamic-tab-component/" target="_blank">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-8 mr-4 icon-external-window">
                    <path class="primary" d="M12 8a1 1 0 0 1-1 1H5v10h10v-6a1 1 0 0 1 2 0v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V9c0-1.1.9-2 2-2h6a1 1 0 0 1 1 1z"></path>
                    <path class="secondary" d="M19 6.41L8.7 16.71a1 1 0 1 1-1.4-1.42L17.58 5H14a1 1 0 0 1 0-2h6a1 1 0 0 1 1 1v6a1 1 0 0 1-2 0V6.41z"></path>
                </svg>
            </a>
        </div>
        <div class="col-10">
            <div class="title"><a href="/blog/2017/07/ng2-dynamic-tab-component/" target="_blank">Create a dynamic tab component with Angular</a></div>
            <div class="description">Learn about advanced topics such as dynamic components, ComponentFactoryResolver, ViewContainerRef, ngTemplateOutlet and much more...</div>
            <div class="link">
                /blog/2017/07/ng2-dynamic-tab-component/
            </div>
        </div>
    </div>
</div>


				<hr />

				Questions? Thoughts? Hit me up <a href="https://twitter.com/juristr" target="_blank">on Twitter</a>
            </div>

            
            <div class="after-post-tags">
                <ul class="tags">
                    
                </ul>
            </div>
            

            <a href="https://egghead.io/instructors/juri-strumpflohner" class="external-link" data-client="eggheadio"
                data-uid="egghead-instructor-page">
                <img src="/blog/assets/imgs/egghead-banner-learn-with-me.png" style="width:100%" />
            </a>

            
            
            
        </div>
        
    </div>
</div>

<div class="hideshare"></div>



<div class="related-container">
    <div class="container">
        <div class="row listrecent listrelated">
            

        </div>
    </div>
</div>

<div class="container">
    <div id="comments" class="row justify-content-center mb-5">
        <div class="col-md-8">              
            <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "juristr" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>               
        </div>
    </div>
</div>



<script type="text/javascript" src="//downloads.mailchimp.com/js/signup-forms/popup/unique-methods/embed.js" data-dojo-config="usePlainJson: true, isDebug: false"></script><script type="text/javascript">window.dojoRequire(["mojo/signup-forms/Loader"], function(L) { L.start({"baseUrl":"mc.us4.list-manage.com","uuid":"04e83acc0ba14b18f30435204","lid":"1d83b68321","uniqueMethods":true}) })</script>
<div class="container">
    
<div class="footer">
    <p class="pull-left">
        &copy; Copyright Juri Strumpflohner - All rights reserved
    </p>
    <p class="pull-right">
        Customized Mediumish Theme, originally by <a target="_blank" href="https://www.wowthemes.net">WowThemes.net</a>
    </p>
    <div class="clearfix">
    </div>
</div>


</div>

    </div>

<script src="/js/jquery.min.js"></script>


<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery-throttle-debounce/1.1/jquery.ba-throttle-debounce.min.js"></script>




<script type="text/javascript" src="/js/bundle.js" integrity=""></script>


<script src="/js/jquery.fluidbox.min.js"></script>
<script>
    $('a.image--zoom,.gallery>a').fluidbox();
</script>

<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-416229-12', 'juristr.com');
    ga('require', 'displayfeatures');
    ga('send', 'pageview');
  </script>






    
    <script type="text/javascript">
        window.cookieconsent_options = {
            "message": "This website uses cookies to ensure you get the best experience on our website",
            "dismiss": "Got it!",
            "learnMore": "More info",
            "link": null,
            "theme": "dark-bottom"
        };
    </script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.9/cookieconsent.min.js" defer></script>
    

    
    
    
    <script>
!function(t,e,a,c,x){var s='q';t[s]={publication_id:c,tags:x};
var s=e.createElement(a),r=e.getElementsByTagName(a)[0];s.async=1,s.src=
'https://insights.quiet.ly/app/analytics.min.js',r.parentNode.insertBefore(s,r)}
(window,document,'script','87bcee90-0c51-4a68-a60b-e95df730d1ca','[]');
</script>
    
 <script>
    if (window.netlifyIdentity) {
      window.netlifyIdentity.on("init", user => {
        if (!user) {
          window.netlifyIdentity.on("login", () => {
            document.location.href = "/admin/";
          });
        }
      });
    }
  </script>
</body>

</html>
