<!DOCTYPE html>
<html lang="en-us"><head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="generator" content="Hugo 0.53" />
	
	<link rel="shortcut icon" href="/assets/images/sitelogo.jpeg">
	
	<title>Git flow with Jenkins and GitLab | juri.dev</title>
	
	
	<meta name="robots" content="index, follow">

	
	<meta name="author" content="Juri Strumpflohner">
	<link rel="me" href="https://profiles.google.com/104904743888756261987" />
	<link rel="publisher" href='https://plus.google.com/104904743888756261987' />
	<meta property="twitter:account_id" content="14407063" />


	
	<meta name="google-site-verification" content="0_vyoIaeMG1kXR0h-48gy3OaGl8xoiSJsFDxxCTIBMs" />
	<meta name="google-site-verification" content="AvmssSjl_nchNXIqBW8Agb_UjGqvvLP7HXSxBZ9d0cg" />

	
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:site" content="@juristr" />
	<meta name="twitter:title" content="Git flow with Jenkins and GitLab" />
	

	
	<meta name="twitter:image:src" content="https://juristr.com/blog/assets/imgs/jenkins-logo.png" />
	

	
	<meta property="og:type" content="article" />
	<meta property="og:title" content="Git flow with Jenkins and GitLab" />
	
	
	<meta property="og:image" content="https://juristr.com/blog/assets/imgs/jenkins-logo.png" />
	
	<meta property="og:url" content="https://juristr.com/blog/2014/01/git-flow-jenkins-gitlab" />
	<meta property="og:site_name" content="juristr.com" />

	
	<link rel="alternate" type="application/rss+xml" title="Juri Strumpflohner" href="//feeds.feedburner.com/juristrumpflohner">
	

	
	<link href="/css/bootstrap.min.css" rel="stylesheet">

	
	
	<link href='//fonts.googleapis.com/css?family=Righteous|Roboto:400,700,900|Source+Code+Pro|Lora:400,700,400italic|Material+Icons'
	 rel='stylesheet' type='text/css'>
	

	

	
	
	
	<link rel="stylesheet" href="/scss/main.min.css" integrity="" media="screen">

	

	

	
	
	<link rel="stylesheet" href="/scss/article.min.css" integrity="" media="screen">
	

	
	
</head><body>
<header class="navbar-light bg-white fixed-top mediumnavigation nav-down">
    <div class="container">

        
        <div class="row justify-content-center align-items-center brandrow">

            <div class="col-lg-4 col-md-4 col-xs-12 d-none d-md-block hidden-xs customarea">
                <img src="/assets/images/gde.svg" style="height:23px">
                <a href="https://google-developers.appspot.com/community/experts/directory/profile/profile-juri_strumpflohner" style="
                    padding-left: 5px;
                    font-size: 15pt;
                ">GDE
                    for Web Tech</a>
                

            </div>

            <div class="col-lg-4 col-md-4  col-xs-12 text-center logoarea">
                <a class="navbar-brand" href="https://juristr.com/">
                    
                    <span style="font-family:Righteous;">juri.dev</span>
                    
                </a>
                
            </div>

            <div class="col-lg-4 col-md-4  col-xs-12 text-right d-none d-md-block">
                <a href="https://twitter.com/juristr" class="twitter-follow-button" data-show-count="true">Follow me!</a>
                <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
            </div>

        </div>
        

        <div class="navarea">

            <nav class="navbar navbar-toggleable-sm">
                
                <div id="bs4navbar" class="navbar-collapse">
                    
                    <ul id="menu-top-menu" class="navbar-nav col-md-12 justify-content-center">
                        
                        <li class="menu-item ">
                            <a class="nav-link" href="/">Home</a>
                        </li>
                        
                        <li class="menu-item ">
                            <a class="nav-link" href="/blog">Blog</a>
                        </li>
                        
                        <li class="menu-item ">
                            <a class="nav-link" href="/categories">Collections</a>
                        </li>
                        
                        <li class="menu-item ">
                            <a class="nav-link" href="/newsletter">Newsletter</a>
                        </li>
                        
                        <li class="menu-item ">
                            <a class="nav-link" href="https://github.com/juristr/ama">AMA</a>
                        </li>
                        
                        <li class="menu-item ">
                            <a class="nav-link" href="/about">About Me</a>
                        </li>
                        
                    </ul>

                    
                </div>
            </nav>

        </div>

    </div>

</header>

    <div class="site-content">



<div class="container page-container">
    <div class="row">
        
        <div class="col-md-2 pl-0"><div class="share">
    <p>
        Share
    </p>
    <ul>
        <li>
            <a target="_blank" href="https://twitter.com/home?status=Check out this post by @juristr https%3a%2f%2fjuristr.com%2fblog%2f2014%2f01%2fgit-flow-jenkins-gitlab%2f">
                <svg class="svgIcon-use" width="29" height="29" viewbox="0 0 29 29">
                    <path d="M21.967 11.8c.018 5.93-4.607 11.18-11.177 11.18-2.172 0-4.25-.62-6.047-1.76l-.268.422-.038.5.186.013.168.012c.3.02.44.032.6.046 2.06-.026 3.95-.686 5.49-1.86l1.12-.85-1.4-.048c-1.57-.055-2.92-1.08-3.36-2.51l-.48.146-.05.5c.22.03.48.05.75.08.48-.02.87-.07 1.25-.15l2.33-.49-2.32-.49c-1.68-.35-2.91-1.83-2.91-3.55 0-.05 0-.01-.01.03l-.49-.1-.25.44c.63.36 1.35.57 2.07.58l1.7.04L7.4 13c-.978-.662-1.59-1.79-1.618-3.047a4.08 4.08 0 0 1 .524-1.8l-.825.07a12.188 12.188 0 0 0 8.81 4.515l.59.033-.06-.59v-.02c-.05-.43-.06-.63-.06-.87a3.617 3.617 0 0 1 6.27-2.45l.2.21.28-.06c1.01-.22 1.94-.59 2.73-1.09l-.75-.56c-.1.36-.04.89.12 1.36.23.68.58 1.13 1.17.85l-.21-.45-.42-.27c-.52.8-1.17 1.48-1.92 2L22 11l.016.28c.013.2.014.35 0 .52v.04zm.998.038c.018-.22.017-.417 0-.66l-.498.034.284.41a8.183 8.183 0 0 0 2.2-2.267l.97-1.48-1.6.755c.17-.08.3-.02.34.03a.914.914 0 0 1-.13-.292c-.1-.297-.13-.64-.1-.766l.36-1.254-1.1.695c-.69.438-1.51.764-2.41.963l.48.15a4.574 4.574 0 0 0-3.38-1.484 4.616 4.616 0 0 0-4.61 4.613c0 .29.02.51.08.984l.01.02.5-.06.03-.5c-3.17-.18-6.1-1.7-8.08-4.15l-.48-.56-.36.64c-.39.69-.62 1.48-.65 2.28.04 1.61.81 3.04 2.06 3.88l.3-.92c-.55-.02-1.11-.17-1.6-.45l-.59-.34-.14.67c-.02.08-.02.16 0 .24-.01 2.12 1.55 4.01 3.69 4.46l.1-.49-.1-.49c-.33.07-.67.12-1.03.14-.18-.02-.43-.05-.64-.07l-.76-.09.23.73c.57 1.84 2.29 3.14 4.28 3.21l-.28-.89a8.252 8.252 0 0 1-4.85 1.66c-.12-.01-.26-.02-.56-.05l-.17-.01-.18-.01L2.53 21l1.694 1.07a12.233 12.233 0 0 0 6.58 1.917c7.156 0 12.2-5.73 12.18-12.18l-.002.04z"></path>
                </svg>
            </a>
        </li>
        <li>
            <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fjuristr.com%2fblog%2f2014%2f01%2fgit-flow-jenkins-gitlab%2f">
                <svg class="svgIcon-use" width="29" height="29" viewbox="0 0 29 29">
                    <path d="M16.39 23.61v-5.808h1.846a.55.55 0 0 0 .546-.48l.36-2.797a.551.551 0 0 0-.547-.62H16.39V12.67c0-.67.12-.813.828-.813h1.474a.55.55 0 0 0 .55-.55V8.803a.55.55 0 0 0-.477-.545c-.436-.06-1.36-.116-2.22-.116-2.5 0-4.13 1.62-4.13 4.248v1.513H10.56a.551.551 0 0 0-.55.55v2.797c0 .304.248.55.55.55h1.855v5.76c-4.172-.96-7.215-4.7-7.215-9.1 0-5.17 4.17-9.36 9.31-9.36 5.14 0 9.31 4.19 9.31 9.36 0 4.48-3.155 8.27-7.43 9.15M14.51 4C8.76 4 4.1 8.684 4.1 14.46c0 5.162 3.75 9.523 8.778 10.32a.55.55 0 0 0 .637-.543v-6.985a.551.551 0 0 0-.55-.55H11.11v-1.697h1.855a.55.55 0 0 0 .55-.55v-2.063c0-2.02 1.136-3.148 3.03-3.148.567 0 1.156.027 1.597.06v1.453h-.924c-1.363 0-1.93.675-1.93 1.912v1.78c0 .3.247.55.55.55h2.132l-.218 1.69H15.84c-.305 0-.55.24-.55.55v7.02c0 .33.293.59.623.54 5.135-.7 9.007-5.11 9.007-10.36C24.92 8.68 20.26 4 14.51 4"></path>
                </svg>
            </a>
        </li>
    </ul>
    
</div></div>
        
        <div class="col-md-9 col-md-offset-2 col-xs-12">
            <div class="mainheading">

                
                
                
                
                <div class="row post-top-meta">
                    
                    <div class="col-md-2">
                        <img class="author-thumb" src="https://www.gravatar.com/avatar/64537dfe80f44978663e378d375c7138?s=150&amp;d=identicon&amp;r=PG" alt="Juri Strumpflohner">
                    </div>
                    <div class="col-md-10">
                        <a class="link-dark" href="/about/">Juri Strumpflohner</a><a href="https://twitter.com/@juristr"
                            class="btn follow">Follow</a>
                        <span class="author-description">Juri is a full stack developer and tech lead with a special passion for the web and frontend development. He creates online videos for <a href="https://egghead.io/instructors/juri-strumpflohner">Egghead.io</a>, writes articles on his blog and for tech magazines, speaks at conferences and holds training workshops. Juri is also a recognized Google Developer Expert in Web Technologies</span>
                        
                    </div>
                    
                </div>
                
                
                
                

                <h1 class="posttitle">Git flow with Jenkins and GitLab</h1>
                
                <p>
                    <span class="post-date">
                        <time class="post-date">
                            Jan 7, 2014
                        </time></span>
                    <span class="dot"></span>
                    <span class="post-read">6 min read</span>
                </p>
            </div>

            
            
            

            
            <a href="https://egghead.io/courses/productive-git-for-developers?af=fj2vsx" class="external-link" data-client="eggheadio" data-uid="url">
                <img src="/assets/images/banners/egghead-banner-productive-git.png" style="width:100%" />
            </a>
            

            
            <div class="article-post">
                

<p>At work I recently helped a team to transition from TFS to using Git as their source control management. After introducing the members to <a href="/blog/2013/04/git-explained/">Git</a>, we also established a common workflow on how we wanted to have Git integrate with Jenkins and GitLab. Below is our current implementation.</p>

<p class="notice tip">
    You might be interested in my latest <a href="/blog/2014/09/implementing-the-git-flow/">"Implementing the git flow" article</a> as well.
</p>

<h2 id="git-branching-strategies">Git branching strategies</h2>

<p>Git branching strategies are guidelines on how to use git&rsquo;s branching mechanism for your development. Establishing such a shared convention is especially useful for having a common vision in the team, in order to have everyone steer in the right direction.</p>

<p>There are a couple of git branching strategies around which I&rsquo;d not like to go into the very details right now. The interested among you might want to consider some of these links</p>

<ul>
<li><a href="http://scottchacon.com/2011/08/31/github-flow.html">GitHub Flow</a></li>
<li><a href="http://nvie.com/posts/a-successful-git-branching-model/">Git Flow</a></li>
<li><a href="http://www.slideshare.net/lemiorhan/git-branching-model">Slideshare: Git Branching Model for efficient development</a></li>
</ul>

<h2 id="making-git-flow-work-on-jenkins-and-gitlab">Making git-flow work on Jenkins and GitLab</h2>

<p>At work, one of our teams recently switched from TFS to Git where we decided to adopt a &ldquo;<a href="http://nvie.com/posts/a-successful-git-branching-model/">git-flow</a>&rdquo; similar style of working, having</p>

<ul>
<li><code>master</code> being the main development branch,</li>
<li><code>production</code> being the one containing the production releases,</li>
<li><code>story/&lt;storyname&gt;</code> being feature branches per userstory</li>
<li>&hellip;and some other support branches for preparing releases, hotfixes etc.</li>
</ul>

<p>These branches get published onto our internal Git server powered by <a href="http://gitlab.org/">GitLab</a>. What we obviously wanted as well is to integrate this strategy with our Jenkins build server, having</p>

<ul>
<li>each checkin on master being automatically deployed in a staging/dev environment</li>
<li>each checkin to a <code>story/</code> branch to be build and verified against the .Net and JavaScript unit tests (and in the future integration tests as well, hopefully)</li>
<li>each checkin to <code>production/</code> to be build, tested and automatically deployed in a &ldquo;production-like&rdquo; environment which is currently only visible to the client, but in the future intended to be accessed by all users</li>
</ul>

<p>Based on the above assumptions we currently create <strong>one Jenkins job per environment</strong>, one for master, one for the user story branches and one for production (although I have the feeling Jenkin&rsquo;s build parameterization could help out here to avoid redundancy between the build configurations&hellip;but didn&rsquo;t look into that, yet). Let&rsquo;s take a look at the <code>master</code> configuration as the others can be easily deduced starting from that one.</p>

<h3 id="1-source-code-management-git-configuration">1. Source Code Management - Git Configuration</h3>

<p>Before starting, make sure you <strong>have the Jenkins <a href="https://wiki.jenkins-ci.org/display/JENKINS/Git+Plugin">Git plugin</a></strong>. Then create a new Jenkins job, and in the &ldquo;Source Code Management&rdquo; section configure your Git repository like in the img example below.</p>

<figure class="image--medium">
  <img src="/blog/assets/imgs/jenkins-gitconfig.png" />
  <figcaption>Git configuration</figcaption>
</figure>

<p>In the <strong>Branch Specifier</strong> field, enter your desired branch, depending on which one you&rsquo;re going to build in this current job. For <em>master</em> simply enter <code>*/master</code>, for building your feature/userstory branches (and given you start them with <code>story/&lt;name&gt;</code>), enter <code>*/story/*</code> and so on.</p>

<h3 id="2-gitlab-webhook">2. GitLab Webhook</h3>

<p>The next step is to add a <strong>web hook to GitLab</strong>. This is needed s.t. GitLab is able to signal to Jenkins about new commits that have been &ldquo;pushed&rdquo; to the repository. This is an alternative, but much more efficient way of instead doing a continuous polling.</p>

<p>Just go to your repository settings and then to <em>Web Hooks</em>.</p>

<figure class="image--medium">
  <img src="/blog/assets/imgs/gitlab-webhook.png" />
  <figcaption>Gitlab hook for communicating with Jenkins</figcaption>
</figure>

<p>Enter an url of the form <code>http://myjenkins.com/git/notifyCommit?url=git@mygitlabserver.com:myrepo.git</code>.</p>

<h3 id="3-activate-polling">3. Activate polling</h3>

<p>The final step is to setup polling. HÃ¤? Sorry, didn&rsquo;t you just mention previously that we don&rsquo;t need polling &lsquo;cause GitLab calls Jenkins in case of new commits?? Yep, that&rsquo;s right, but that&rsquo;s part of a &ldquo;security&rdquo; measure the <a href="https://wiki.jenkins-ci.org/display/JENKINS/Git+Plugin#GitPlugin-Pushnotificationfromrepository">guys creating the Git plugin introduced</a> to make sure you (that you control the Jenkins job) and you (that you added the Web Hook) both consent to execute the build based on new commits.</p>

<blockquote>
<p>This will scan all the jobs that&rsquo;s configured to check out the specified URL, the optional branches, and if they are also configured with polling, it&rsquo;ll immediately trigger the polling (and if that finds a change worth a build, a build will be triggered in turn.) We require the polling configuration on the job so that we only trigger jobs that are supposed to be kicked from changes in the source tree. <cite><a href="https://wiki.jenkins-ci.org/display/JENKINS/Git+Plugin#GitPlugin-Pushnotificationfromrepository">Source</a></cite></p>
</blockquote>

<p>However, in the polling configuration you don&rsquo;t have to specify any kind of interval, meaning that it won&rsquo;t start by its own. You simply tick the checkbox &ldquo;Poll SCM&rdquo; to give your consent (somehow).</p>

<figure class="image--medium">
  <img src="/blog/assets/imgs/jenkins-gitpolling.png" />
  <figcaption>Git polling configuration</figcaption>
</figure>

<p>That&rsquo;s it, now your Jenkins jobs should start based on the branch you configured in your job and based on the branch that gets pushed to GitLab, just as we wanted.</p>

<h3 id="alternative-approaches">Alternative approaches</h3>

<p>In case you just need to trigger the build of a branch from GitLab, you can also simply configure Jenkin&rsquo;s <strong>remote trigger</strong> and add that as a Web Hook to your GitLab repo</p>

<figure class="image--medium">
  <img src="/blog/assets/imgs/jenkins-gitremote-trigger.png" />
  <figcaption>Remote trigger configuration</figcaption>
</figure>

<p>The downside of this approach is that you&rsquo;re not able to selectively launch builds based on commits on certain branches.</p>

<p>Finally, I also found a plugin called <strong><a href="https://wiki.jenkins-ci.org/display/JENKINS/Gitlab+Hook+Plugin">GitLab Hook</a></strong> which I didn&rsquo;t try yet as the above described approach was much simpler (and didn&rsquo;t require the installation of a plugin). On their page they write that</p>

<blockquote>
<p>For GitLab [&hellip;] For Gitlab there is an existing solution that might work for you.
You can just use the notifyCommit hook on Git plugin like this. [&hellip;] But, with a large number of projects that are mostly polling (no hooks), the project might actually be built with a great delay (5 to 20 minutes).
You can find more details about notifyCommit and this <a href="http://kohsuke.org/2011/12/01/polling-must-die-triggering-jenkins-builds-from-a-git-hook/">issue here</a>. <cite><a href="https://wiki.jenkins-ci.org/display/JENKINS/Gitlab+Hook+Plugin">GitLab Hook plugin page</a></cite></p>
</blockquote>

<p>I did not experience any of such delays so far, but we&rsquo;ll see.</p>

<h2 id="automatically-build-all-feature-branches">Automatically build all feature branches</h2>

<p>Not only with Git flow, but in general when you work with feature branches and Merge/Pull requests it makes a lot of sense to automatically build those on your build server and execute the tests in order to make sure those branches would pass the build pipeline. There are different strategies for doing so.</p>

<p>One possibility is to <strong>establish a naming convention</strong> for feature branches like a common prefix, i.e. <code>feat-&lt;name&gt;</code> or <code>fix-&lt;name&gt;</code>. In that way it is possible to selectively create Jenkins build jobs that monitor those branches:</p>

<figure class="image--medium">
    <img src="/blog/assets/imgs/jenkins-build-dedicatedbranch.png" />
    <figcaption>Only build branches that have the prefix "userstory/&lt;name&gt;"</figcaption>
</figure>

<p>The other strategy is to <strong>simply build all branches other than master</strong> (probably a more naive approach).</p>

<ol>
<li>Under &ldquo;Source Code Management&rdquo; choose Git</li>
<li>Click the &ldquo;Add&rdquo; button towards the end of the plugin section and choose &ldquo;Strategy for choosing what to build&rdquo;</li>
</ol>

<figure class="image--medium">
    <img src="/blog/assets/imgs/jenkins-build-otherthanmaster.png" />
    <figcaption>build all branches other than master</figcaption>
</figure>


				<hr />

				Questions? Thoughts? Hit me up <a href="https://twitter.com/juristr" target="_blank">on Twitter</a>
            </div>

            
            <div class="after-post-tags">
                <ul class="tags">
                    
                </ul>
            </div>
            

            <a href="https://egghead.io/instructors/juri-strumpflohner" class="external-link" data-client="eggheadio"
                data-uid="egghead-instructor-page">
                <img src="/blog/assets/imgs/egghead-banner-learn-with-me.png" style="width:100%" />
            </a>

            
            
            
        </div>
        
    </div>
</div>

<div class="hideshare"></div>



<div class="related-container">
    <div class="container">
        <div class="row listrecent listrelated">
            

        </div>
    </div>
</div>

<div class="container">
    <div id="comments" class="row justify-content-center mb-5">
        <div class="col-md-8">              
            <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "juristr" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>               
        </div>
    </div>
</div>



<script type="text/javascript" src="//downloads.mailchimp.com/js/signup-forms/popup/unique-methods/embed.js" data-dojo-config="usePlainJson: true, isDebug: false"></script><script type="text/javascript">window.dojoRequire(["mojo/signup-forms/Loader"], function(L) { L.start({"baseUrl":"mc.us4.list-manage.com","uuid":"04e83acc0ba14b18f30435204","lid":"1d83b68321","uniqueMethods":true}) })</script>
<div class="container">
    
<div class="footer">
    <p class="pull-left">
        &copy; Copyright Juri Strumpflohner - All rights reserved
    </p>
    <p class="pull-right">
        Customized Mediumish Theme, originally by <a target="_blank" href="https://www.wowthemes.net">WowThemes.net</a>
    </p>
    <div class="clearfix">
    </div>
</div>


</div>

    </div>

<script src="/js/jquery.min.js"></script>


<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery-throttle-debounce/1.1/jquery.ba-throttle-debounce.min.js"></script>




<script type="text/javascript" src="/js/bundle.js" integrity=""></script>


<script src="/js/jquery.fluidbox.min.js"></script>
<script>
    $('a.image--zoom,.gallery>a').fluidbox();
</script>

<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-416229-12', 'juristr.com');
    ga('require', 'displayfeatures');
    ga('send', 'pageview');
  </script>






    
    <script type="text/javascript">
        window.cookieconsent_options = {
            "message": "This website uses cookies to ensure you get the best experience on our website",
            "dismiss": "Got it!",
            "learnMore": "More info",
            "link": null,
            "theme": "dark-bottom"
        };
    </script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.9/cookieconsent.min.js"></script>
    

    
    
    
    <script>
!function(t,e,a,c,x){var s='q';t[s]={publication_id:c,tags:x};
var s=e.createElement(a),r=e.getElementsByTagName(a)[0];s.async=1,s.src=
'https://insights.quiet.ly/app/analytics.min.js',r.parentNode.insertBefore(s,r)}
(window,document,'script','87bcee90-0c51-4a68-a60b-e95df730d1ca','[]');
</script>
</body>

</html>
